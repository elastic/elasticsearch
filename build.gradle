description = 'Builds the Prelert Engine native binaries and Java classes'

import org.gradle.internal.os.OperatingSystem

project.ext.make = OperatingSystem.current().isLinux() ? "make" : "gnumake"
project.ext.numCpus = Runtime.runtime.availableProcessors()

task cppclean(type: Exec) {
    commandLine make
    args 'clean'
}

task cppobjcompile(type: Exec) {
    commandLine make
    args '-j' + numCpus, 'objcompile'
}

task cppmake(type: Exec) {
    commandLine make
    args '-j' + numCpus
}

task cpptest(type: Exec) {
    commandLine make
    args '-j' + numCpus, 'test'
}

subprojects {
    apply plugin: 'maven'
    apply plugin: 'java'

    compileJava.options.encoding = 'UTF-8'
    compileTestJava.options.encoding = 'UTF-8'

    group = 'com.prelert'
    version = '2.3.0'
    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenLocal()
        maven { url "http://repo.maven.apache.org/maven2" }
    }

    configurations.all {
    }

    dependencies {
        testCompile group: 'org.ini4j', name: 'ini4j', version:'0.5.2'
        // Includes: junit, hamcrest and mockito
        testCompile group: 'org.elasticsearch.test', name: 'framework', version: '5.0.0-beta1'
    }
}


#!/bin/bash

set -e -o pipefail

source "`dirname "$0"`"/elasticsearch-env

# use a small heap size for the CLI tools, and thus the serial collector to
# avoid stealing many CPU cycles; a user can override by setting CLI_JAVA_OPTS
CLI_JAVA_OPTS="-Xms4m -Xmx32m -XX:+UseSerialGC -XX:MaxHeapFreeRatio=10 -XX:MinHeapFreeRatio=5 -XX:-ShrinkHeapInSteps \
-XX:-UseAdaptiveSizePolicy -XX:TrimNativeHeapInterval=2000 -XX:ThreadStackSize=256 -XX:MaxMetaspaceSize=16m \
-XX:-TieredCompilation -XX:ReservedCodeCacheSize=8m ${CLI_JAVA_OPTS}"

LAUNCHER_CLASSPATH=$ES_HOME/lib/*:$ES_HOME/lib/cli-launcher/*

exec \
  "$JAVA" \
  $CLI_JAVA_OPTS \
  -Dcli.name="$CLI_NAME" \
  -Dcli.script="$0" \
  -Dcli.libs="$CLI_LIBS" \
  -Des.path.home="$ES_HOME" \
  -Des.path.conf="$ES_PATH_CONF" \
  -Des.distribution.type="$ES_DISTRIBUTION_TYPE" \
  -Des.java.type="$JAVA_TYPE" \
  -cp "$LAUNCHER_CLASSPATH" \
  org.elasticsearch.launcher.CliToolLauncher \
  "$@"

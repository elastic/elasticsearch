pr: 135051
summary: Ban Limit + `MvExpand` before remote Enrich
area: ES|QL
type: bug
issues: []
highlight:
  title: Mark Limit + MvExpand before remote Enrich as unsupported
  body: |-
    Due to the distribured nature of remote `ENRICH`, using a `LIMIT` command followed by a `MV_EXPAND` command before a remote `ENRICH` command
    can lead to incorrect results. Such queries are identified by the engine and marked as unsupported, leading to query failure. Example:
    [source,yaml]
    ----------------------------
    FROM *:events | SORT @timestamp | LIMIT 2 | MV_EXPAND ip | ENRICH _remote:clientip_policy ON ip
    ----------------------------
    Such query will now produce an error. The users are advised to rewrite it (e.g. by placing `ENRICH` earlier in the query) to avoid the error.

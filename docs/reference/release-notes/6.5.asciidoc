////
// To add a release, copy and paste the following text,  uncomment the relevant
// sections, and add a link to the new section in the list of releases in
// ../release-notes.asciidoc. Note that release subheads must be floated and
// sections cannot be empty.
// TEMPLATE

// [[release-notes-n.n.n]]
// == {es} version n.n.n

// coming[n.n.n]

// Also see <<breaking-changes-n.n>>.

// [float]
// [[breaking-n.n.n]]
// === Breaking Changes

// [float]
// [[breaking-java-n.n.n]]
// === Breaking Java Changes

// [float]
// [[deprecation-n.n.n]]
// === Deprecations

// [float]
// [[feature-n.n.n]]
// === New Features

// [float]
// [[enhancement-n.n.n]]
// === Enhancements

// [float]
// [[bug-n.n.n]]
// === Bug Fixes

// [float]
// [[regression-n.n.n]]
// === Regressions

// [float]
// === Known Issues
////

[[release-notes-6.5.4]]
== {es} version 6.5.4

Also see <<breaking-changes-6.5,Breaking changes in 6.5>>.

[[bug-6.5.4]]
[float]
=== Bug fixes

Aggregations::
* Fix MultiValuesSourceFieldConfig toXContent {es-pull}36525[#36525] (issue: {es-issue}36474[#36474])

Audit::
* Fix origin.type for connection_* events {es-pull}36410[#36410]

CCR::
* Fix follow stats API's follower index filtering feature {es-pull}36647[#36647]

Machine learning::
* Interrupt Grok in file structure finder timeout {es-pull}36588[#36588]
* Prevent stack overflow while copying {ml} jobs and datafeeds {es-pull}36370[#36370] (issue: {es-issue}36360[#36360])
* Fix a problem that could result in shifted model bounds and increased forecast
errors with long bucket spans. The solution was to correct query times for model
bounds and forecasts in the bucket to match the times assigned to the samples
that are added to the model for each bucket. {ml-pull}327[#327]

SQL::
* Fix MOD() for long and integer arguments {es-pull}36599[#36599] (issue: {es-issue}36364[#36364])
* Fix issue with complex HAVING and GROUP BY ordinal {es-pull}36594[#36594] (issue: {es-issue}36059[#36059])

Watcher::
* Fix Watcher NotificationService's secure settings {es-pull}35610[#35610] (issue: {es-issue}35378[#35378])


[[release-notes-6.5.3]]
== {es} version 6.5.3

Also see <<breaking-changes-6.5>>.

[float]
[[enhancement-6.5.3]]
=== Enhancements

Engine::
* Always configure soft-deletes field of IndexWriterConfig {es-pull}36196[#36196] (issue: {es-issue}36141[#36141])

[float]
[[bug-6.5.3]]
=== Bug fixes

Audit::
* Fix deprecation of audit log settings {es-pull}36175[#36175] (issue: {es-issue}36162[#36162])

CCR::
* AutoFollowCoordinator should tolerate that auto follow patterns may be removed {es-pull}35945[#35945] (issue: {es-issue}35937[#35937])

Features/Monitoring::
* Add missing error type mapping for apm-server {es-pull}36178[#36178] (issue: {es-issue}1614[#1614])

Infra/Packaging::
* Fix error message when package install fails due to missing Java {es-pull}36077[#36077] (issue: {es-issue}31845[#31845])

Infra/Scripting::
* Properly support no-offset date formatting {es-pull}36316[#36316] (issue: {es-issue}36306[#36306])
* Fix serialization bug in painless execute api request {es-pull}36075[#36075] (issue: {es-issue}36050[#36050])

Security::
* Remove license state listeners on closables {es-pull}36308[#36308] (issues: {es-issue}33328[#33328], {es-issue}35627[#35627], {es-issue}35628[#35628])

Snapshot/Restore::
* Improve Resilience SnapshotShardService {es-pull}36113[#36113] (issue: {es-issue}32265[#32265])


[[release-notes-6.5.2]]
== {es} version 6.5.2


Also see <<breaking-changes-6.5,Breaking changes in 6.5>>.


[[release-notes-6.5.1]]
== {es} version 6.5.1

Also see <<breaking-changes-6.5,Breaking changes in 6.5>>.

[float]
[[enhancement-6.5.1]]
=== Enhancements

Authorization::
* Grant .tasks access to kibana_system role {es-pull}35573[#35573]

Search::
* has_parent builder: exception message/param fix {es-pull}31182[#31182]

[float]
[[bug-6.5.1]]
=== Bug fixes

Aggregations::
* Correct implemented interface of ParsedReverseNested {es-pull}35455[#35455] (issue: {es-issue}35449[#35449])
* Handle IndexOrDocValuesQuery in composite aggregation {es-pull}35392[#35392]
* Preserve `format` when aggregation contains unmapped date fields {es-pull}35254[#35254] (issue: {es-issue}31760[#31760])

Infra/Core::
* Upgrade to Joda 2.10.1 {es-pull}35410[#35410] (issue: {es-issue}33749[#33749])

Machine Learning::
* Fix find_file_structure NPE with should_trim_fields {es-pull}35465[#35465] (issue: {es-issue}35462[#35462])
* Prevent notifications being created on deletion of a non existent job {es-pull}35337[#35337] (issues: {es-issue}34058[#34058], {es-issue}35336[#35336])

SQL::
* Fix query translation for scripted queries {es-pull}35408[#35408] (issue: {es-issue}35232[#35232])
* Clear the cursor if nested inner hits are enough to fulfill the query required limits {es-pull}35398[#35398] (issue: {es-issue}35176[#35176])
* SQL: Introduce IsNull node to simplify expressions {es-pull}35206[#35206] (issues: {es-issue}34876[#34876], {es-issue}35171[#35171])

Scripting::
* [Painless] Partially fixes def boxed types casting {es-pull}35563[#35563] (issue: {es-issue}35351[#35351])

[[release-notes-6.5.0]]
== {es} version 6.5.0 

Also see <<breaking-changes-6.5,Breaking changes in 6.5>>.

[[breaking-6.5.0]]
[float]
=== Breaking changes

Aggregations::
* Require combine and reduce scripts in scripted metrics aggregation {es-pull}33452[#33452] (issue: {es-issue}32804[#32804])

Geo::
* Geo: Don't flip longitude of envelopes crossing dateline {es-pull}34535[#34535] (issue: {es-issue}34418[#34418])

Mapping::
* Disallow "enabled" attribute change for types in mapping update (#33566) {es-pull}33933[#33933]

Plugins::
* Introduce index store plugins {es-pull}32375[#32375] (issue: {es-issue}32267[#32267])



[[breaking-java-6.5.0]]
[float]
=== Breaking Java changes

Authorization::
* Use RoleRetrievalResult for better caching {es-pull}34197[#34197] (issue: {es-issue}33205[#33205])

Core::
* Use generic AcknowledgedResponse instead of extended classes {es-pull}32859[#32859]
* Switch WritePipelineResponse to AcknowledgedResponse {es-pull}32722[#32722]

Java High Level REST Client::
* HLRC XPack Protocol clean up: Licence, Misc {es-pull}34469[#34469] (issue: {es-issue}34451[#34451])

Plugins::
* Fix generics in ScriptPlugin#getContexts() {es-pull}33426[#33426]



[[deprecation-6.5.0]]
[float]
=== Deprecations

Analysis::
* Deprecates the standard filter {es-pull}33468[#33468]

Scripting::
* Scripting: Conditionally use java time api in scripting {es-pull}31441[#31441]

Search::
* Deprecate negative query boost (#34486) {es-pull}34512[#34512] (issues: {es-issue}33309[#33309], {es-issue}34486[#34486])
* Deprecate negative `weight` in Function Score Query {es-pull}33624[#33624] (issue: {es-issue}31927[#31927])

Suggesters::
* Make Geo Context Mapping Parsing More Strict (6.x version) {es-pull}32862[#32862] (issue: {es-issue}32821[#32821])



[[feature-6.5.0]]
[float]
=== New features

Aggregations::
* Adds a new auto-interval date histogram {es-pull}28993[#28993] (issue: {es-issue}9572[#9572])

Analysis::
* Add script_filter tokenfilter {es-pull}33431[#33431]
* Add conditional token filter to elasticsearch {es-pull}31958[#31958]

Audit::
* Structured audit logging {es-pull}31931[#31931] and {es-pull}33894[#33894] (backport) (issue: {es-issue}31046[#31046])
This introduces a new format for the logfile audit type which is output alongside the
previous one. Conforming to the out-of-the-box `log4j2.properties` configuration,
the new and deprecated audit formats are output to the `<cluster_name>_access.log`
and `<cluster_name>_audit.log` files, respectively.
See <<audit-log-output>> for more details.

Authentication::
* Allow User/Password realms to disable authc {es-pull}34033[#34033] (issue: {es-issue}33292[#33292])

Authorization::
* [X-Pack] Beats centralized management: security role + licensing {es-pull}34305[#34305] (issues: {es-issue}30493[#30493], {es-issue}30520[#30520])
* Add get-user-privileges API {es-pull}33928[#33928] (issue: {es-issue}32777[#32777])
* Add support for "authorization_realms" {es-pull}33262[#33262]

CCR::
* [CCR] Added auto follow patterns feature {es-pull}33118[#33118] (issue: {es-issue}33007[#33007])

Index APIs::
* Add an index setting to control TieredMergePolicy#deletesPctAllowed {es-pull}32907[#32907]

Java High Level REST Client::
* add start trial API to HLRC {es-pull}32799[#32799]

Machine Learning::
* Add a file structure determination endpoint {es-pull}33471[#33471]
* Partition-wise maximum scores {es-pull}32748[#32748]

Mapping::
* New Annotated_text field type {es-pull}30364[#30364] (issue: {es-issue}29467[#29467])

Monitoring::
* APM server monitoring {es-pull}32515[#32515]

SQL::
* SQL: Implement `CONVERT`, an alternative to `CAST` {es-pull}34660[#34660] (issue: {es-issue}34513[#34513])
* SQL: Implement IN(value1, value2, ...) expression. {es-pull}34581[#34581] (issue: {es-issue}32955[#32955])
* SQL: TRUNCATE and ROUND functions {es-pull}33779[#33779] (issue: {es-issue}33494[#33494])
* SQL: Adds MONTHNAME, DAYNAME and QUARTER functions {es-pull}33411[#33411] (issue: {es-issue}33092[#33092])

Search::
* Add max_children limit to nested sort {es-pull}33587[#33587] (issue: {es-issue}33592[#33592])



[[enhancement-6.5.0]]
[float]
=== Enhancements

Aggregations::
* Rollup adding support for date field metrics (#34185) {es-pull}34200[#34200] (issue: {es-issue}34185[#34185])
* Add early termination support for min/max aggregations {es-pull}33375[#33375]
* Add early termination support to BucketCollector {es-pull}33279[#33279]
* Add interval response parameter to AutoDateInterval histogram {es-pull}33254[#33254]
* Scripted metric aggregations: add deprecation warning and system property to control legacy params {es-pull}31597[#31597] (issues: {es-issue}29328[#29328], {es-issue}30111[#30111])

Allocation::
* Skip rebalancing when cluster_concurrent_rebalance threshold reached {es-pull}33329[#33329] (issue: {es-issue}27628[#27628])

Analysis::
* Allow TokenFilterFactories to rewrite themselves against their preceding chain {es-pull}33702[#33702] (issue: {es-issue}33609[#33609])

Audit::
* Add opaque_id to index audit logging {es-pull}32260[#32260] (issue: {es-issue}31521[#31521])

Authentication::
* Security: reduce memory usage of DnRoleMapper {es-pull}34250[#34250] (issue: {es-issue}34237[#34237])
* Security: upgrade unboundid ldapsdk to 4.0.8 {es-pull}34247[#34247] (issue: {es-issue}33175[#33175])
* [Kerberos] Add realm name & UPN to user metadata {es-pull}33338[#33338]
* [SECURITY] Set Auth-scheme preference {es-pull}33156[#33156] (issue: {es-issue}32699[#32699])
* Token API supports the client_credentials grant {es-pull}33106[#33106]

Authorization::
* [Authz] Allow update settings action for system user {es-pull}34030[#34030] (issue: {es-issue}33119[#33119])
* Calculate changed roles on roles.yml reload {es-pull}33525[#33525] (issue: {es-issue}33205[#33205])
* [Kerberos] Add authorization realms support to Kerberos realm {es-pull}32392[#32392]
* [X-Pack] Beats centralized management: security role + licensing {es-pull}30520[#30520] (issue: {es-issue}30493[#30493])

Beats Plugin::
* [Monitoring] Update beats template to include apm-server metrics {es-pull}33286[#33286]

CRUD::
* Verify primary mode usage with assertions {es-pull}32667[#32667] (issues: {es-issue}10708[#10708], {es-issue}25692[#25692], {es-issue}32442[#32442])
* Refactor TransportShardBulkAction to better support retries {es-pull}31821[#31821]

Circuit Breakers::
* Whitelisting / from Circuit Breaker Exception (#32325) {es-pull}32666[#32666]

Core::
* Improved IndexNotFoundException's default error message {es-pull}34649[#34649] (issue: {es-issue}34628[#34628])
*  Prevent cause from being null in ShardOperationFailedException  {es-pull}32640[#32640] (issue: {es-issue}32608[#32608])
* Enable avoiding mmap bootstrap check {es-pull}32421[#32421] (issue: {es-issue}32267[#32267])

Discovery-Plugins::
* [GCE Discovery] Automatically set project-id and zone {es-pull}33721[#33721] (issue: {es-issue}13618[#13618])

Distributed::
* Add contains method to LocalCheckpointTracker {es-pull}33871[#33871] (issue: {es-issue}33656[#33656])
* Introduce global checkpoint listeners {es-pull}32696[#32696] (issue: {es-issue}32651[#32651])
* Expose whether or not the global checkpoint updated {es-pull}32659[#32659] (issue: {es-issue}32651[#32651])
* Include translog path in error message when translog is corrupted {es-pull}32251[#32251] (issue: {es-issue}24929[#24929])

Docs Infrastructure::
* Docs: Allow snippets to have line continuation {es-pull}32649[#32649]

Engine::
* Do not alloc full buffer for small change requests {es-pull}35158[#35158]
* Fill LocalCheckpointTracker with Lucene commit {es-pull}34474[#34474] (issues: {es-issue}0[#0], {es-issue}2[#2], {es-issue}33656[#33656])
* Lock down Engine.Searcher {es-pull}34363[#34363] (issue: {es-issue}34357[#34357])
* Fold EngineSearcher into Engine.Searcher {es-pull}34082[#34082]
* Build DocStats from SegmentInfos in ReadOnlyEngine {es-pull}34079[#34079] (issue: {es-issue}33903[#33903])
* Move CompletionStats into the Engine {es-pull}33847[#33847] (issue: {es-issue}33835[#33835])
* Move DocsStats into Engine {es-pull}33835[#33835]
* Add read-only Engine {es-pull}33563[#33563] (issues: {es-issue}32844[#32844], {es-issue}32867[#32867])
* Allow engine to recover from translog upto a seqno {es-pull}33032[#33032] (issue: {es-issue}32867[#32867])

Index APIs::
* Introduce index settings version {es-pull}34429[#34429]
* Add cluster-wide shard limit warnings {es-pull}34021[#34021] (issues: {es-issue}20705[#20705], {es-issue}32856[#32856])
* Copy and validate soft-deletes setting on resize {es-pull}33517[#33517] (issue: {es-issue}33321[#33321])
* Introduce mapping version to index metadata {es-pull}33147[#33147]
* update rollover to leverage write-alias semantics {es-pull}32216[#32216]

Ingest::
*  ingest: processor stats  {es-pull}34724[#34724] (issue: {es-issue}34202[#34202])
* ingest: better support for conditionals with simulate?verbose {es-pull}34155[#34155]
* ingest: correctly measure chained pipeline stats {es-pull}33912[#33912]
* ingest: support simulate with verbose for pipeline processor {es-pull}33839[#33839]
* [ingest] geo-ip performance improvements {es-pull}33029[#33029]
* ingest: Introduce the dissect processor {es-pull}32884[#32884]
* INGEST: Add Pipeline Processor {es-pull}32473[#32473] (issue: {es-issue}31842[#31842])
* Ingest: Add conditional per processor {es-pull}32398[#32398] (issue: {es-issue}21248[#21248])
* Introduce the dissect library {es-pull}32297[#32297]
* INGEST: Enable default pipelines {es-pull}32286[#32286] (issue: {es-issue}21101[#21101])
* INGEST: Implement Drop Processor {es-pull}32278[#32278] (issue: {es-issue}23726[#23726])
* Ingest: Support integer and long hex values in convert {es-pull}32213[#32213] (issue: {es-issue}32182[#32182])
* Add region ISO code to GeoIP Ingest plugin {es-pull}31669[#31669]

Java High Level REST Client::
* HLRC: Delete role API {es-pull}34620[#34620]
* [HLRC] Add support for Delete role mapping API {es-pull}34531[#34531]
* [HLRC] Add Start/Stop Watch Service APIs. {es-pull}34317[#34317]
* HLRC: ML Add preview datafeed api {es-pull}34284[#34284] (issue: {es-issue}29827[#29827])
* HLRC: ML Adding get datafeed stats API {es-pull}34271[#34271] (issue: {es-issue}29827[#29827])
* HLRC: Deactivate Watch API {es-pull}34192[#34192] (issues: {es-issue}29827[#29827], {es-issue}33988[#33988])
* Create/Update role mapping API {es-pull}34171[#34171] (issue: {es-issue}33745[#33745])
* HLRC: Get SSL Certificates API {es-pull}34135[#34135]
* [ML][HLRC] Replace REST-based ML test cleanup with the ML client {es-pull}34109[#34109]
* HLRC: Add activate watch action {es-pull}33988[#33988] (issue: {es-issue}29827[#29827])
* Add support for 'ack watch' to the HLRC. {es-pull}33962[#33962] (issue: {es-issue}29827[#29827])
* HLRC: Add throttling for update & delete-by-query {es-pull}33951[#33951]
* HLRC: ML Stop datafeed API {es-pull}33946[#33946] (issue: {es-issue}29827[#29827])
* HLRC: Add get rollup job {es-pull}33921[#33921]
* HLRC: ML start data feed API {es-pull}33898[#33898] (issue: {es-issue}29827[#29827])
*  HLRC: Add support for reindex rethrottling {es-pull}33832[#33832]
* HLRC: Reindex should support `requests_per_seconds` parameter {es-pull}33808[#33808]
* HLRC: Delete ML calendar {es-pull}33775[#33775] (issue: {es-issue}29827[#29827])
* HLRC: Get ML calendars {es-pull}33760[#33760] (issue: {es-issue}29827[#29827])
* [HLRC] Support for role mapper expression dsl {es-pull}33745[#33745]
* [HLRC][ML] Add ML get datafeed API to HLRC {es-pull}33715[#33715] (issue: {es-issue}29827[#29827])
* REST client: introduce a strict deprecation mode  {es-pull}33708[#33708] (issue: {es-issue}33534[#33534])
* [HLRC][ML] Add ML delete datafeed API to HLRC {es-pull}33667[#33667] (issue: {es-issue}29827[#29827])
* HLRC: Add support for XPack Post Start Basic Licence API {es-pull}33606[#33606] (issue: {es-issue}29827[#29827])
* [HLRC][ML] Add ML put datafeed API to HLRC {es-pull}33603[#33603] (issue: {es-issue}29827[#29827])
* Create a WatchStatus class for the high-level REST client. {es-pull}33527[#33527]
* HLRC: ML Delete Forecast API {es-pull}33526[#33526] (issue: {es-issue}29827[#29827])
* Add create rollup job api to high level rest client {es-pull}33521[#33521] (issues: {es-issue}29827[#29827], {es-issue}32703[#32703])
* HLRC: add change password API support {es-pull}33509[#33509] (issue: {es-issue}33481[#33481])
* HLRC: ML Forecast Job {es-pull}33506[#33506] (issue: {es-issue}29827[#29827])
* HLRC: add enable and disable user API support {es-pull}33481[#33481] (issue: {es-issue}29827[#29827])
* HLRC: Add ML get categories API {es-pull}33465[#33465] (issue: {es-issue}29827[#29827])
* HLRC: ML Post Data {es-pull}33443[#33443] (issue: {es-issue}29827[#29827])
* add start trial API to HLRC {es-pull}33406[#33406]
* HLRC: ML Update Job {es-pull}33392[#33392] (issue: {es-issue}29827[#29827])
* HLRC: Add ML get influencers API {es-pull}33389[#33389] (issue: {es-issue}29827[#29827])
* HLRC: ML PUT Calendar {es-pull}33362[#33362] (issue: {es-issue}29827[#29827])
* HLRC: Add ML get overall buckets API {es-pull}33297[#33297] (issue: {es-issue}29827[#29827])
* HLRC: create base timed request class {es-pull}33216[#33216]
* HLRC: add client side RefreshPolicy {es-pull}33209[#33209]
* HLRC: ML Flush job {es-pull}33187[#33187] (issue: {es-issue}29827[#29827])
* HLRC: Adding ML Job stats {es-pull}33183[#33183] (issue: {es-issue}29827[#29827])
* HLRC: Use Optional in validation logic {es-pull}33104[#33104]
* HLRC: Add ML Get Records API {es-pull}33085[#33085] (issue: {es-issue}29827[#29827])
* HLRC: Add ML Get Buckets API {es-pull}33056[#33056] (issue: {es-issue}29827[#29827])
* GraphClient for the high level REST client and associated tests. {es-pull}33025[#33025] (issue: {es-issue}29827[#29827])
* HLRC: Clear ML data after client tests {es-pull}33023[#33023] (issue: {es-issue}32993[#32993])
* HLRC: Add ML Get Job {es-pull}32960[#32960] (issue: {es-issue}29827[#29827])
* HLRC: ML Close Job {es-pull}32943[#32943] (issue: {es-issue}29827[#29827])
* HLRC: Create server agnostic request and response {es-pull}32912[#32912]
* Add GetRollupCaps API to high level rest client {es-pull}32880[#32880] (issues: {es-issue}29827[#29827], {es-issue}32703[#32703])
* HLRC: adding machine learning open job {es-pull}32860[#32860] (issue: {es-issue}29827[#29827])
* HLRC: Refactor WatchStatus {es-pull}32842[#32842] (issue: {es-issue}29827[#29827])
* HLRC: adding machine learning delete job {es-pull}32820[#32820] (issue: {es-issue}29827[#29827])
* HLRC: Refactor WatchStatus and implement activate watch {es-pull}32802[#32802] (issue: {es-issue}29827[#29827])
* REST high-level client: add delete by query API {es-pull}32782[#32782] (issues: {es-issue}27205[#27205], {es-issue}32679[#32679], {es-issue}32760[#32760])
* REST high-level client: add update by query API {es-pull}32760[#32760] (issues: {es-issue}27205[#27205], {es-issue}32679[#32679])
* HLRC: migration get assistance API {es-pull}32744[#32744] (issue: {es-issue}29827[#29827])
* Adding ML HLRC wrapper and put_job API call {es-pull}32726[#32726]
* Add create rollup job api to high level rest client {es-pull}32703[#32703] (issue: {es-issue}29827[#29827])
* REST high-level client: add reindex API {es-pull}32679[#32679] (issue: {es-issue}27205[#27205])
* HLRC: Add Delete License API {es-pull}32586[#32586] (issue: {es-issue}29827[#29827])
* Rest HL client: Add get license action {es-pull}32438[#32438] (issue: {es-issue}29827[#29827])
* HLRC: Add delete watch action {es-pull}32337[#32337] (issue: {es-issue}29827[#29827])
* HLRest: add xpack put user API {es-pull}32332[#32332] (issue: {es-issue}29827[#29827])
* Rest HL client: Add put license action {es-pull}32214[#32214] (issue: {es-issue}29827[#29827])
* Add Restore Snapshot High Level REST API {es-pull}32155[#32155] (issue: {es-issue}27205[#27205])
* Add put stored script support to high-level rest client {es-pull}31323[#31323] (issue: {es-issue}27205[#27205])

Logging::
* Logging: Make node name consistent in logger {es-pull}31588[#31588]

Machine Learning::
* Adding support for lazy nodes {es-pull}34538[#34538] (issue: {es-issue}29991[#29991])
* Add an ingest pipeline definition to structure finder {es-pull}34350[#34350]
* Add a timeout option to file structure finder {es-pull}34117[#34117]
* Allow asynchronous job deletion {es-pull}34058[#34058] (issue: {es-issue}32836[#32836])
* Make certain ML node settings dynamic {es-pull}33961[#33961] (issue: {es-issue}33565[#33565])
* Display integers without .0 in file structure field stats {es-pull}33947[#33947]
* Return both Joda and Java formats from structure finder {es-pull}33900[#33900]
* Adding node_count to ML Usage {es-pull}33863[#33863] (issue: {es-issue}33850[#33850])
* Delete custom index if the only contained job is deleted {es-pull}33788[#33788] (issue: {es-issue}30075[#30075])
* Allow overrides for some file structure detection decisions {es-pull}33630[#33630]
* Minor improvements to categorization Grok pattern creation {es-pull}33353[#33353]
* Delete forecast API {es-pull}33218[#33218] (issue: {es-issue}31134[#31134])
* Perform anomaly detection on features derived from multiple bucket values to
improve the robustness of detection with respect to misconfigured bucket lengths
and to improve the detection of long lasting anomalies. {ml-pull}175[#175]
* Support decomposing a time series into a piecewise linear trend and with
piecewise constant scaling of the periodic components. This extends our
decomposition functionality to handle the same types of change points that our
modelling capabilities do. {ml-pull}198[#198]
* Increased independence of anomaly scores across partitions. {ml-pull}182[#182]
* Avoid potential false positives at model start up when first detecting new
components of the time series decomposition. {ml-pull}218[#218]
* Add a new label (`multi_bucket_impact`) to record level anomaly results. The
value is on a scale of -5 to +5 where -5 means the anomaly is purely single
bucket and +5 means the anomaly is purely multi bucket. {es-pull}34233[#34233],
{ml-pull}230[#230]
* Improve our ability to detect change points in the presence of outliers.
{ml-pull}265[#265]

Mapping::
* Preserve the order of nested documents in the Lucene index {es-pull}34225[#34225] (issue: {es-issue}33587[#33587])
* Don't count metadata fields towards index.mapping.total_fields.limit {es-pull}33386[#33386] (issue: {es-issue}24096[#24096])
* Add expected mapping type to `MapperException` {es-pull}31564[#31564] (issue: {es-issue}31502[#31502])

Monitoring::
* [Monitoring] Add additional necessary mappings for apm-server {es-pull}34392[#34392]
* Adding stack_monitoring_agent role {es-pull}34369[#34369]
* [Monitoring] Add cluster metadata to cluster_stats docs {es-pull}33860[#33860] (issue: {es-issue}33691[#33691])
* Implement xpack.monitoring.elasticsearch.collection.enabled setting {es-pull}33474[#33474] (issue: {es-issue}33290[#33290])

Network::
* Pass the host name on as `server_name` if proxy mode is on {es-pull}34559[#34559]
* Bad regex in CORS settings should throw a nicer error {es-pull}34035[#34035]
* Add sni name to SSLEngine in netty transport (#33144) {es-pull}33513[#33513] (issue: {es-issue}32517[#32517])
* Add sni name to SSLEngine in netty transport {es-pull}33144[#33144] (issue: {es-issue}32517[#32517])
* Add proxy support to RemoteClusterConnection {es-pull}33062[#33062] (issues: {es-issue}31840[#31840], {es-issue}32517[#32517])
* Use a dedicated ConnectionManger for RemoteClusterConnection {es-pull}32988[#32988] (issue: {es-issue}31835[#31835])

Packaging::
* Add Ubuntu 18.04 to packaging tests {es-pull}34139[#34139]

Ranking::
* Add minimal sanity checks to custom/scripted similarities. (backport) {es-pull}33893[#33893] (issue: {es-issue}33564[#33564])
* Use the global doc id to generate random scores {es-pull}33599[#33599]

Recovery::
* Use soft-deleted docs to resolve strategy for engine operation {es-pull}35230[#35230] (issues: {es-issue}0[#0], {es-issue}1[#1], {es-issue}33656[#33656], {es-issue}34474[#34474])
* Propagate auto_id_timestamp in primary-replica resync {es-pull}33964[#33964] (issue: {es-issue}33693[#33693])
* Restore local history from translog on promotion {es-pull}33616[#33616] (issues: {es-issue}32867[#32867], {es-issue}33473[#33473])
* Reset replica engine to global checkpoint on promotion {es-pull}33473[#33473] (issue: {es-issue}32867[#32867])
* Bootstrap a new history_uuid when force allocating a stale primary {es-pull}33432[#33432] (issue: {es-issue}26712[#26712])
* Integrates soft-deletes into Elasticsearch {es-pull}33222[#33222] (issues: {es-issue}29530[#29530], {es-issue}30086[#30086], {es-issue}30120[#30120], {es-issue}30335[#30335], {es-issue}30522[#30522], {es-issue}31106[#31106])

Rollup::
* [Rollup] Add support for date histo `format` when searching {es-pull}34537[#34537] (issue: {es-issue}34391[#34391])
* [Rollup] Only allow aggregating on multiples of configured interval {es-pull}32052[#32052]

SQL::
* SQL: Improve CircuitBreaker logic for SqlParser {es-pull}35300[#35300] (issue: {es-issue}35299[#35299])
* SQL: Optimizer rule for folding nullable expressions {es-pull}35080[#35080] (issue: {es-issue}34826[#34826])
* SQL: Improve painless script generated from `IN` {es-pull}35055[#35055] (issue: {es-issue}34750[#34750])
* SQL: Implement CAST between STRING and IP {es-pull}34949[#34949] (issue: {es-issue}34799[#34799])
* SQL: Fix function args verification and error msgs {es-pull}34926[#34926] (issues: {es-issue}33469[#33469], {es-issue}34752[#34752])
* SQL: Introduce ODBC mode, similar to JDBC {es-pull}34825[#34825] (issue: {es-issue}34720[#34720])
* SQL: Introduce support for IP fields {es-pull}34758[#34758] (issue: {es-issue}32499[#32499])
* SQL: Implement null handling for `IN(v1, v2, ...)` {es-pull}34750[#34750] (issue: {es-issue}34582[#34582])
* SQL: handle X-Pack or X-Pack SQL not being available in a more graceful way {es-pull}34736[#34736] (issue: {es-issue}30009[#30009])
* SQL: Support pattern against compatible indices {es-pull}34718[#34718] (issues: {es-issue}31611[#31611], {es-issue}31837[#31837], {es-issue}33803[#33803])
* SQL: Allow min/max aggregates on date fields {es-pull}34699[#34699] (issue: {es-issue}34477[#34477])
* SQL: Introduce support for NULL values (#34573) {es-pull}34640[#34640] (issue: {es-issue}32079[#32079])
* SQL: return constants for all matching records in constants-containing SELECTs {es-pull}34576[#34576] (issue: {es-issue}31863[#31863])
* SQL: Functions enhancements (OCTET_LENGTH function, order functions alphabetically, RANDOM function docs) {es-pull}34101[#34101] (issue: {es-issue}33477[#33477])
* SQL: Internal refactoring of operators as functions {es-pull}34097[#34097] (issue: {es-issue}33975[#33975])
* SQL: Remove more ANTLR4 grammar ambiguities {es-pull}34074[#34074] (issue: {es-issue}33854[#33854])
* SQL: Move away internally from JDBCType to SQLType {es-pull}33913[#33913] (issue: {es-issue}33904[#33904])
* SQL: Fix ANTL4 Grammar ambiguities. {es-pull}33854[#33854] (issue: {es-issue}31885[#31885])
* SQL: Better handling of number parsing exceptions {es-pull}33776[#33776] (issue: {es-issue}33622[#33622])
* SQL: Grammar tweak for number declarations {es-pull}33767[#33767] (issue: {es-issue}33765[#33765])
* SQL: Return functions in JDBC driver metadata {es-pull}33672[#33672] (issue: {es-issue}33671[#33671])
* SQL: Make Literal a NamedExpression {es-pull}33583[#33583] (issue: {es-issue}33523[#33523])
* SQL: Improve alias vs index resolution {es-pull}33393[#33393] (issue: {es-issue}33363[#33363])
* SQL: Align SYS TABLE for ODBC SQL_ALL_* args {es-pull}33364[#33364] (issue: {es-issue}33312[#33312])
* SQL: Show/desc commands now support table ids {es-pull}33363[#33363] (issue: {es-issue}33294[#33294])
* SQL: Support multi-index format as table identifier {es-pull}33278[#33278]
* SQL: Multiple indices pattern {es-pull}33162[#33162]
* SQL: skip uppercasing/lowercasing function tests for AZ locales as well {es-pull}32910[#32910] (issue: {es-issue}32589[#32589])
* SQL: test coverage for JdbcResultSet {es-pull}32813[#32813] (issue: {es-issue}32078[#32078])
* SQL: Added support for string manipulating functions with more than one parameter {es-pull}32356[#32356] (issue: {es-issue}31604[#31604])

Scripting::
* Painless: Add Static Methods Shortcut {es-pull}33440[#33440]
* Painless: Add Bindings {es-pull}33042[#33042]

Search::
* Replace version with reader cache key in IndicesRequestCache {es-pull}34189[#34189] (issues: {es-issue}27650[#27650], {es-issue}33473[#33473])
* Handle terms query when detecting if a query can match nested docs {es-pull}34072[#34072] (issue: {es-issue}34067[#34067])
* Add a limit for graph phrase query expansion {es-pull}34031[#34031]
* Clarify RemoteClusterService#groupIndices behaviour {es-pull}33899[#33899]
* Add nested and object fields to field capabilities response {es-pull}33803[#33803] (issue: {es-issue}33237[#33237])
* Introduce a `search_throttled` threadpool {es-pull}33732[#33732]
* Upgrade remote cluster settings {es-pull}33537[#33537] (issues: {es-issue}33413[#33413], {es-issue}33536[#33536])
* Remove unsupported group_shard_failures parameter {es-pull}33208[#33208] (issue: {es-issue}32598[#32598])
* Profiler: Donâ€™t profile NEXTDOC for ConstantScoreQuery. {es-pull}33196[#33196] (issue: {es-issue}23430[#23430])
* Change query field expansion {es-pull}33020[#33020] (issues: {es-issue}31655[#31655], {es-issue}31798[#31798])
* Expose `max_concurrent_shard_requests` in `_msearch` {es-pull}33016[#33016] (issue: {es-issue}31877[#31877])
* Search: Support of wildcard on docvalue_fields {es-pull}32980[#32980] (issues: {es-issue}26299[#26299], {es-issue}26390[#26390])
* Ignore script fields when size is 0 {es-pull}31917[#31917] (issue: {es-issue}31824[#31824])

Security::
* Generate non-encrypted license public key {es-pull}34626[#34626]
* Security: don't call prepare index for reads {es-pull}34568[#34568] (issues: {es-issue}33205[#33205], {es-issue}34246[#34246])
* Enable security automaton caching {es-pull}34028[#34028]
* Add Debug/Trace logging to token service {es-pull}34022[#34022]
* Security index expands to a single replica {es-pull}33131[#33131] (issues: {es-issue}29712[#29712], {es-issue}29933[#29933])
* Introduce fips_mode setting and associated checks {es-pull}32326[#32326]

Settings::
* Introduce private settings {es-pull}33327[#33327] (issue: {es-issue}31286[#31286])
* Add user-defined cluster metadata {es-pull}33325[#33325] (issue: {es-issue}33220[#33220])
* Add settings updater for 2 affix settings {es-pull}33050[#33050]

Snapshot/Restore::
* Use more precise does S3 bucket exist method {es-pull}34123[#34123]
* Add `_source`-only snapshot repository {es-pull}32844[#32844]
* Increase max chunk size to 256Mb for repo-azure {es-pull}32101[#32101] (issue: {es-issue}12448[#12448])
* Update AWS SDK to 1.11.340  in repository-s3 {es-pull}30723[#30723] (issues: {es-issue}22758[#22758], {es-issue}25552[#25552], {es-issue}30474[#30474])

Stats::
* Add cluster UUID to Cluster Stats API response {es-pull}32206[#32206] (issue: {es-issue}32205[#32205])

Store::
* add elasticsearch-shard tool to 6.x {es-pull}33848[#33848] (issue: {es-issue}31389[#31389])
* drop `index.shard.check_on_startup: fix` {es-pull}32279[#32279] (issue: {es-issue}31389[#31389])

Suggesters::
* Completion types with multi-fields support {es-pull}34081[#34081] (issue: {es-issue}15115[#15115])

Watcher::
* Watcher: Reduce script cache churn by checking for mustache tags {es-pull}33978[#33978] (issue: {es-issue}29280[#29280])
* [Watcher] Improved error messages for CronEvalTool {es-pull}32800[#32800] (issue: {es-issue}32735[#32735])
* Watcher: Use Bulkprocessor in HistoryStore/TriggeredWatchStore {es-pull}32490[#32490]
* Watcher: migrate PagerDuty v1 events API to v2 API {es-pull}32285[#32285] (issue: {es-issue}32243[#32243])

ZenDiscovery::
* Allow excluding folder names when scanning for dangling indices {es-pull}34349[#34349]



[[bug-6.5.0]]
[float]
=== Bug fixes

Aggregations::
* Fix handling of empty keyword in terms aggregation {es-pull}34457[#34457] (issue: {es-issue}34434[#34434])
* Check self references in metric agg after last doc collection (#33593) {es-pull}34001[#34001]
* Unmapped aggs should not run pipelines if they delegate reduction {es-pull}33528[#33528] (issue: {es-issue}33514[#33514])
* For filters aggregations, make sure that rewrites preserve other_bucket. {es-pull}32921[#32921] (issue: {es-issue}32834[#32834])

Allocation::
* DiskThresholdDecider#canAllocate can report negative free bytes {es-pull}33641[#33641] (issue: {es-issue}33596[#33596])
* Don't omit default values when updating routing exclusions (#32721) {es-pull}33638[#33638]

Analysis::
* Check stemmer language setting early {es-pull}34601[#34601] (issue: {es-issue}34170[#34170])

Authentication::
* ListenableFuture should preserve ThreadContext {es-pull}34394[#34394]
* Allow an AuthenticationResult to return metadata {es-pull}34382[#34382] (issues: {es-issue}34290[#34290], {es-issue}34332[#34332])
* Preserve thread context during authentication  {es-pull}34290[#34290]
* [Kerberos] Add debug log statement for exceptions {es-pull}32663[#32663]
* [Kerberos] Remove Kerberos bootstrap checks {es-pull}32451[#32451]

Authorization::
* Handle missing user in user privilege APIs {es-pull}34575[#34575] (issue: {es-issue}34567[#34567])
* Allow query caching by default again {es-pull}33328[#33328] (issue: {es-issue}33191[#33191])
* Fix role query that can match nested documents {es-pull}32705[#32705]
* Make get all app privs requires "*" permission {es-pull}32460[#32460]

CAT APIs::
* Fix potential NPE in `_cat/shards/` with partial CommonStats {es-pull}33858[#33858]
* Cat apis: Fix index creation time to use strict date format {es-pull}32510[#32510] (issue: {es-issue}32466[#32466])

CRUD::
* Fix DeleteRequest validation for nullable or empty id/type {es-pull}35314[#35314] (issue: {es-issue}35297[#35297])
* Fix NOOP bulk updates {es-pull}32819[#32819] (issues: {es-issue}31821[#31821], {es-issue}32808[#32808])

Circuit Breakers::
* Make accounting circuit breaker settings dynamic {es-pull}34372[#34372] (issue: {es-issue}34368[#34368])

Core::
* Fix AutoQueueAdjustingExecutorBuilder settings validation {es-pull}33922[#33922]
* Fix Javadoc issues in 6.x for JDK11 {es-pull}33579[#33579]
* Core: Add java time xcontent serializers {es-pull}33120[#33120] (issue: {es-issue}31853[#31853])
* Protect scheduler engine against throwing listeners {es-pull}32998[#32998]
* Fix content type detection with leading whitespace {es-pull}32632[#32632] (issue: {es-issue}32357[#32357])

Distributed::
* Only notify ready global checkpoint listeners {es-pull}33690[#33690]
* Enable global checkpoint listeners to timeout {es-pull}33620[#33620] (issue: {es-issue}32696[#32696])
* Fix race between replica reset and primary promotion {es-pull}32442[#32442] (issues: {es-issue}32118[#32118], {es-issue}32304[#32304], {es-issue}32431[#32431])

Engine::
* Acquire seacher on closing engine should throw AlreadyClosedException {es-pull}33331[#33331] (issue: {es-issue}33330[#33330])
* Trim unreferenced translog when the safe commit advanced {es-pull}32967[#32967] (issues: {es-issue}28140[#28140], {es-issue}32089[#32089])
* All Translog inner closes should happen after tragedy exception is set {es-pull}32674[#32674] (issue: {es-issue}32526[#32526])

Geo::
* Fix north pole overflow error in GeoHashUtils.bbox() {es-pull}32891[#32891] (issue: {es-issue}32857[#32857])
* Use the determinant formula for calculating the orientation of a polygon {es-pull}27967[#27967]

Index APIs::
* Make XContentBuilder in AliasActions build `is_write_index` field {es-pull}35071[#35071]
* Do not update number of replicas on no indices {es-pull}34481[#34481]
* [Security] Get Alias API wildcard exclusion with Security {es-pull}34144[#34144] (issues: {es-issue}33518[#33518], {es-issue}33805[#33805])
* Allow to clear the fielddata cache per field {es-pull}33807[#33807] (issue: {es-issue}33798[#33798])
* CORE: Make Pattern Exclusion Work with Aliases {es-pull}33518[#33518] (issue: {es-issue}33395[#33395])
* Fix IndexMetaData loads after rollover {es-pull}33394[#33394] (issue: {es-issue}33316[#33316])
* Copy missing segment attributes in getSegmentInfo {es-pull}32396[#32396]

Ingest::
* INGEST: Create Index Before Pipeline Execute {es-pull}32786[#32786] (issue: {es-issue}32758[#32758])

Java High Level REST Client::
* HLRC: Fixing bug when getting a missing pipeline {es-pull}34286[#34286] (issue: {es-issue}34119[#34119])
* Aggregations/HL Rest client fix: missing scores {es-pull}32774[#32774] (issue: {es-issue}32770[#32770])
* HLRC: Ban LoggingDeprecationHandler {es-pull}32756[#32756] (issue: {es-issue}32151[#32151])
* HLRC: Move commercial clients from XPackClient {es-pull}32596[#32596]
* High-level client: fix clusterAlias parsing in SearchHit {es-pull}32465[#32465]
* REST high-level client: parse back _ignored meta field {es-pull}32362[#32362]

License::
* Address license state update/read thread safety {es-pull}33396[#33396]

Logging::
* Logging: Configure the node name when we have it {es-pull}32983[#32983] (issue: {es-issue}32793[#32793])

Machine Learning::
* Handle pre-6.x time fields {es-pull}34373[#34373]
* Fix updating opened jobs scheduled events {es-pull}32881[#32881] (issue: {es-issue}31651[#31651])
* Clear Job#finished_time when it is opened {es-pull}32755[#32755]
* Fix thread leak when waiting for job flush {es-pull}32541[#32541] (issue: {es-issue}32196[#32196])

Mapping::
* Fix field mapping updates with similarity {es-pull}33634[#33634] (issue: {es-issue}33611[#33611])
* Ensure that _exists queries on keyword fields use norms when they're available. {es-pull}33006[#33006]
* Make sure that field collapsing supports field aliases. {es-pull}32648[#32648] (issue: {es-issue}32623[#32623])
* Improve the error message when an index is incompatible with field aliases. {es-pull}32482[#32482]

Monitoring::
* Typo in x-pack template for thread_pool.management {es-pull}34224[#34224]

Network::
* NETWORKING: Add SSL Handler before other Handlers {es-pull}34636[#34636] (issue: {es-issue}33998[#33998])
* Handle null SSLSessions during invalidation {es-pull}34130[#34130] (issue: {es-issue}32124[#32124])
*  Support PKCS#11 tokens as keystores and truststores  {es-pull}34063[#34063] (issue: {es-issue}11[#11])
* Parse PEM Key files leniantly {es-pull}33173[#33173] (issue: {es-issue}33168[#33168])
* NETWORKING: http.publish_host Should Contain CNAME {es-pull}32806[#32806] (issue: {es-issue}22029[#22029])
* NETWORKING: Make RemoteClusterConn. Lazy Resolve DNS {es-pull}32764[#32764] (issue: {es-issue}28858[#28858])
* Release requests in cors handle {es-pull}32410[#32410]
* Release requests in cors handler {es-pull}32364[#32364]

Packaging::
* Fix use of hostname in Windows service {es-pull}34193[#34193]
* Add temporary directory cleanup workarounds {es-pull}32615[#32615] (issue: {es-issue}31732[#31732])

Percolator::
* Ignore date ranges containing 'now' when pre-processing a percolator query {es-pull}35160[#35160]

REST API::
* Core: Fix IndicesSegmentResponse.toXcontent() serialization {es-pull}33414[#33414] (issue: {es-issue}29120[#29120])

Recovery::
* Resync fails to notify on unavaiable exceptions {es-pull}33615[#33615] (issues: {es-issue}31179[#31179], {es-issue}33613[#33613])
* Ensure to generate identical NoOp for the same failure {es-pull}33141[#33141] (issue: {es-issue}32986[#32986])

Rollup::
* [Rollup] Proactively resolve index patterns in RollupSearch endoint {es-pull}34930[#34930] (issue: {es-issue}34828[#34828])
* Address BWC bug due to default metrics in (#34764) {es-pull}34810[#34810] (issue: {es-issue}34764[#34764])
* Allowing \{index\}/_xpack/rollup/data to accept comma delimited list {es-pull}34115[#34115]
* [Rollup] Fix Caps Comparator to handle calendar/fixed time {es-pull}33336[#33336] (issue: {es-issue}32052[#32052])
* [Rollup] Better error message when trying to set non-rollup index {es-pull}32965[#32965]
* [Rollup] Return empty response when aggs are missing {es-pull}32796[#32796] (issue: {es-issue}32256[#32256])
* [Rollup] Improve ID scheme for rollup documents {es-pull}32558[#32558] (issue: {es-issue}32372[#32372])

SQL::
* SQL: Fix null handling for AND and OR in SELECT {es-pull}35277[#35277] (issue: {es-issue}35240[#35240])
* SQL: Handle null literal for AND and OR in `WHERE` {es-pull}35236[#35236] (issue: {es-issue}35088[#35088])
* SQL: Introduce NotEquals node to simplify expressions {es-pull}35234[#35234] (issues: {es-issue}35210[#35210], {es-issue}35233[#35233])
* SQL: handle wildcard expansion on incorrect fields {es-pull}35134[#35134] (issue: {es-issue}35092[#35092])
* SQL: Fix null handling for IN => painless script {es-pull}35124[#35124] (issues: {es-issue}35108[#35108], {es-issue}35122[#35122])
* SQL: Register missing processors {es-pull}35121[#35121] (issue: {es-issue}35119[#35119])
* SQL: Fix NPE thrown if HAVING filter evals to null {es-pull}35108[#35108] (issue: {es-issue}35107[#35107])
* SQL: Proper handling of nested fields at the beginning of the columns list {es-pull}35068[#35068] (issue: {es-issue}32951[#32951])
* SQL: Fix incorrect AVG data type {es-pull}34948[#34948] (issue: {es-issue}33773[#33773])
* SQL: Add `CAST` and `CONVERT` to `SHOW FUNCTIONS` {es-pull}34940[#34940] (issue: {es-issue}34939[#34939])
* SQL: Handle aggregation for null group {es-pull}34916[#34916] (issue: {es-issue}34896[#34896])
* SQL: Provide null-safe scripts for Not and Neg {es-pull}34877[#34877] (issue: {es-issue}34848[#34848])
* SQL: Return error with ORDER BY on non-grouped. {es-pull}34855[#34855] (issue: {es-issue}34590[#34590])
* SQL: Fix queries with filter resulting in NO_MATCH {es-pull}34812[#34812] (issue: {es-issue}34613[#34613])
* SQL: Fix edge case: `<field> IN (null)` {es-pull}34802[#34802] (issue: {es-issue}34750[#34750])
* SQL: Verifier allows aliases aggregates for sorting {es-pull}34773[#34773] (issue: {es-issue}34607[#34607])
* SQL: the SSL default configuration shouldn't override the https protocol if used {es-pull}34635[#34635] (issue: {es-issue}33817[#33817])
* JDBC: Fix artifactId in pom {es-pull}34478[#34478] (issue: {es-issue}34399[#34399])
* SQL: Fix grammar for `*` in arithm expressions {es-pull}34176[#34176] (issue: {es-issue}33957[#33957])
* SQL: Fix function resolution {es-pull}34137[#34137] (issue: {es-issue}34114[#34114])
* SQL: Fix query translation of GroupBy with Having {es-pull}34010[#34010] (issue: {es-issue}33520[#33520])
* SQL: Prevent StackOverflowError when parsing large statements {es-pull}33902[#33902] (issue: {es-issue}32942[#32942])
* SQL: Fix issue with options for QUERY() and MATCH(). {es-pull}33828[#33828] (issue: {es-issue}32602[#32602])
* SQL: Return correct catalog separator in JDBC {es-pull}33670[#33670] (issue: {es-issue}33654[#33654])
* SQL: Fix result column names for CAST {es-pull}33604[#33604] (issue: {es-issue}33571[#33571])
* SQL: Fix result column names for arithmetic functions {es-pull}33500[#33500] (issues: {es-issue}14[#14], {es-issue}31869[#31869])
* SQL: Fix bug in REPLACE function. Adds more tests to all string functions {es-pull}33478[#33478]
* SQL: handle differently security connection related errors in the CLI {es-pull}33255[#33255] (issue: {es-issue}33230[#33230])
* SQL: prevent duplicate generation for repeated aggs {es-pull}33252[#33252] (issue: {es-issue}30287[#30287])
* SQL: Enable aggregations to create a separate bucket for missing values {es-pull}32832[#32832] (issue: {es-issue}32831[#32831])
* SQL: Bug fix for the optional "start" parameter usage inside LOCATE function {es-pull}32576[#32576] (issue: {es-issue}32554[#32554])
* SQL: Minor fix for javadoc {es-pull}32573[#32573] (issue: {es-issue}32553[#32553])

Scripting::
* Scripting: Add back lookup vars in score script {es-pull}34833[#34833]
* Scripting: Add back params._source access in scripted metric aggs {es-pull}34777[#34777] (issue: {es-issue}33884[#33884])
* Test: Fix last reference to SearchScript {es-pull}34731[#34731] (issue: {es-issue}34683[#34683])
* Ensure map keys cannot be self referencing {es-pull}34569[#34569]
* [Painless] Add a Map for java names to classes for use in the custom classloader {es-pull}34424[#34424]
* [Painless] Allow statically imported methods without whitelisted class {es-pull}34370[#34370]
* Painless: Remove caching of Painless scripts {es-pull}34116[#34116]
* Painless: Fix Bindings Bug {es-pull}33274[#33274]
* Painless: Fix Semicolon Regression {es-pull}33212[#33212] (issue: {es-issue}33193[#33193])
* Scripting: Fix painless compiler loader to know about context classes {es-pull}32385[#32385]

Search::
* Fix inner_hits retrieval when stored fields are disabled {es-pull}34652[#34652] (issues: {es-issue}32941[#32941], {es-issue}33018[#33018])
* Fix cross fields mode of the query_string query {es-pull}34216[#34216] (issue: {es-issue}34215[#34215])
* Support 'string'-style queries on metadata fields when reasonable. {es-pull}34089[#34089] (issue: {es-issue}34062[#34062])
* Improves doc values format deprecation message {es-pull}33576[#33576] (issue: {es-issue}33572[#33572])
* Fix nested _source retrieval with includes/excludes {es-pull}33180[#33180] (issues: {es-issue}33163[#33163], {es-issue}33170[#33170])
* Fix quoted _exists_ query {es-pull}33019[#33019] (issue: {es-issue}28922[#28922])
* Fix multi fields empty query {es-pull}33017[#33017] (issue: {es-issue}33009[#33009])
* XContentBuilder to handle BigInteger and BigDecimal {es-pull}32888[#32888] (issue: {es-issue}32395[#32395])
* Do NOT allow termvectors on nested fields {es-pull}32728[#32728] (issues: {es-issue}21625[#21625], {es-issue}32652[#32652])
* Cross-cluster search: preserve cluster alias in shard failures {es-pull}32608[#32608]

Security::
* Security: use x-pack config files when present {es-pull}33688[#33688] (issue: {es-issue}33464[#33464])
* Security: use default scroll keepalive {es-pull}33639[#33639]
* Enable FIPS140LicenseBootstrapCheck {es-pull}32903[#32903] (issue: {es-issue}32437[#32437])

Settings::
* CORE: Validate Type for String Settings {es-pull}33503[#33503] (issue: {es-issue}33135[#33135])
* Fix deprecated setting specializations {es-pull}33412[#33412]
* Apply settings filter to get cluster settings API {es-pull}33247[#33247]

Snapshot/Restore::
* Register Azure max_retries setting {es-pull}35286[#35286]
* Do not override named S3 client credentials {es-pull}33793[#33793] (issue: {es-issue}33769[#33769])
* Ensure fully deleted segments are accounted for correctly {es-pull}33757[#33757] (issues: {es-issue}32844[#32844], {es-issue}33689[#33689], {es-issue}33755[#33755])

Suggesters::
* Fix completion suggester's score tie-break {es-pull}34508[#34508] (issue: {es-issue}34378[#34378])
* Null completion field should not throw IAE {es-pull}33268[#33268]

Transport API::
* Fix serialization of empty field capabilities response {es-pull}33263[#33263]

Watcher::
* watcher: Fix integration tests to ensure correct start/stop of Watcher {es-pull}35271[#35271] (issues: {es-issue}29877[#29877], {es-issue}30705[#30705], {es-issue}33291[#33291], {es-issue}34448[#34448], {es-issue}34462[#34462])
* Make Watcher validation message copy/pasteable {es-pull}33497[#33497] (issue: {es-issue}33369[#33369])
* Watcher: Reload properly on remote shard change {es-pull}33167[#33167]
* Watcher: Fix race condition when reloading watches {es-pull}33157[#33157]
* Guard against null in email admin watches {es-pull}32923[#32923] (issue: {es-issue}32590[#32590])
* Watcher: Properly find next valid date in cron expressions {es-pull}32734[#32734]

ZenDiscovery::
* Fix logging of cluster state update descriptions {es-pull}34182[#34182] (issue: {es-issue}28941[#28941])



[[regression-6.5.0]]
[float]
=== Regressions

Search::
* Preserve index_uuid when creating QueryShardException {es-pull}32677[#32677] (issue: {es-issue}32608[#32608])



[[upgrade-6.5.0]]
[float]
=== Upgrades

Core::
* CORE: Upgrade to Jackson 2.8.11 {es-pull}32670[#32670] (issue: {es-issue}30352[#30352])
* Dependencies: Upgrade to joda time 2.10 {es-pull}32160[#32160]

Ingest::
* Update geolite2 database in ingest geoip plugin {es-pull}33840[#33840]

Logging::
* LOGGING: Upgrade to Log4J 2.11.1 (#32616) {es-pull}32656[#32656] (issues: {es-issue}27300[#27300], {es-issue}32537[#32537])
* LOGGING: Upgrade to Log4J 2.11.1 {es-pull}32616[#32616] (issues: {es-issue}27300[#27300], {es-issue}32537[#32537])

Network::
* NETWORKING: Upgrade Netty to 4.1.30 {es-pull}34417[#34417] (issue: {es-issue}34411[#34411])
* NETWORKING: Upgrade to Netty 4.1.29 {es-pull}33984[#33984]

Search::
* Upgrade to Lucene-7.5.0-snapshot-13b9e28f9d {es-pull}32730[#32730]
* Upgrade to Lucene-7.5.0-snapshot-608f0277b0 {es-pull}32390[#32390]

Watcher::
* Dependencies: Update javax.mail in watcher to 1.6.2 {es-pull}33664[#33664]

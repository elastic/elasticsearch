plugins {
  id 'application'
}

apply plugin: 'elasticsearch.build'
apply plugin: 'elasticsearch.publish'

tasks.named("dependencyLicenses").configure {
  mapping from: /asm-.*/, to: 'asm'
}

tasks.named('run') {
  modularity.inferModulePath = true
}

group = 'org.elasticsearch.entitlement.tools'

ext {
  javaMainClass = "org.elasticsearch.entitlement.tools.securitymanager.scanner.Main"
}

application {
  mainModule.set('elasticsearch.libs.entitlement.tools.securitymanager.scanner')
  mainClass.set(javaMainClass)
  applicationDefaultJvmArgs = [
    '--add-exports', 'java.base/sun.security.util=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/java.lang=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/java.net=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/java.net.spi=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/java.util.concurrent=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/javax.crypto=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/javax.security.auth=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/jdk.internal.logger=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.base/sun.nio.ch=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'jdk.management.jfr/jdk.management.jfr=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.logging/java.util.logging=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.logging/sun.util.logging.internal=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.naming/javax.naming.ldap.spi=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.rmi/sun.rmi.runtime=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'jdk.dynalink/jdk.dynalink=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'jdk.dynalink/jdk.dynalink.linker=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.desktop/sun.awt=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.sql.rowset/javax.sql.rowset.spi=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.sql/java.sql=elasticsearch.libs.entitlement.tools.securitymanager.scanner',
    '--add-opens', 'java.xml.crypto/com.sun.org.apache.xml.internal.security.utils=elasticsearch.libs.entitlement.tools.securitymanager.scanner'
  ]
}



repositories {
  mavenCentral()
}

dependencies {
  implementation 'org.ow2.asm:asm:9.7'
  implementation 'org.ow2.asm:asm-util:9.7'
  implementation 'org.ow2.asm:asm-tree:9.7'
  implementation 'org.ow2.asm:asm-analysis:9.7'
  implementation(project(':libs:entitlement:tools:common'))
}

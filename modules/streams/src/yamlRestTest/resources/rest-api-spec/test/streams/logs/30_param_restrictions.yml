---
teardown:
  - do:
      streams.logs_disable: { }

---
"Check User Can't Use Restricted Params On Logs Endpoint":
  - do:
      streams.logs_enable: { }
  - is_true: acknowledged

  - do:
      streams.status: { }
  - is_true: logs.enabled

  - do:
      bulk:
        refresh: true
        body: |
          { "index": { "_index": "logs"} }
          { "foo": "bar" }
          { "index": { "_index": "not-logs" } }
          { "foo": "bar" }
  - match: { errors: true }
  - match: { items.0.index.status: 400 }
  - match: { items.0.index.error.type: "illegal_argument_exception" }
  - match: { items.0.index.error.reason: "When writing to a stream, only the following parameters are allowed: [error_trace,timeout]" }
  - match: { items.1.index.status: 201 }

---
"Check User Can't Use Restricted Params On Logs Endpoint - Single Doc":
  - do:
      streams.logs_enable: { }
  - is_true: acknowledged

  - do:
      streams.status: { }
  - is_true: logs.enabled

  - do:
      index:
        refresh: true
        index: logs
        body: { "foo": "bar" }
      catch: bad_request

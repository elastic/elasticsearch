import org.gradle.api.file.ArchiveOperations

apply plugin: 'elasticsearch.java'

def patched = Attribute.of('patched', Boolean)

configurations {
  thejar {
    canBeResolved = true
    attributes {
      attribute(patched, true)
    }
  }
}

dependencies {
  thejar("org.apache.hadoop:hadoop-client-api:${project.parent.versions.hadoop}") {
    transitive = false
  }
  attributesSchema {
    attribute(patched)
  }
  artifactTypes.getByName("jar") {
    attributes.attribute(patched, false)
  }
  registerTransform(org.elasticsearch.gradle.internal.dependencies.patches.hdfs.HdfsClassPatcher) {
    from.attribute(patched, false)
    to.attribute(patched, true)
    parameters {
      matchingArtifacts = ["hadoop-common", "hadoop-auth"]
    }
  }
}

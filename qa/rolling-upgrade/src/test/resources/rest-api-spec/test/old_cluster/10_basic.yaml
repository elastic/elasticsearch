---
"Index data and search on the old cluster":
 - do:
     indices.create:
        index: test_index
        wait_for_active_shards : all
        body:
          settings:
            index:
              number_of_replicas: 1

 - do:
     bulk:
        refresh: true
        body:
          - '{"index": {"_index": "test_index", "_type": "test_type"}}'
          - '{"f1": "v1_old", "f2": 0}'
          - '{"index": {"_index": "test_index", "_type": "test_type"}}'
          - '{"f1": "v2_old", "f2": 1}'
          - '{"index": {"_index": "test_index", "_type": "test_type"}}'
          - '{"f1": "v3_old", "f2": 2}'
          - '{"index": {"_index": "test_index", "_type": "test_type"}}'
          - '{"f1": "v4_old", "f2": 3}'
          - '{"index": {"_index": "test_index", "_type": "test_type"}}'
          - '{"f1": "v5_old", "f2": 4}'

 - do:
     indices.flush:
        index: test_index

 - do:
     search:
        index: test_index

 - match: { hits.total: 5 }

 - do:
     cluster.health:
        index: ".monitoring-*" # include monitoring-data-* and monitoring-es-*
        wait_for_active_shards: 4 # 1 primary and 1 replica each for the two monitoring indices
        timeout: 25s

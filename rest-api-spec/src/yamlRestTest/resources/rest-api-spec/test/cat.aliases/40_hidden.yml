---
"Test cat aliases output with a hidden index with a hidden alias":
  - requires:
      test_runner_features: headers
      cluster_features: ["gte_v7.7.0"]
      reason: "hidden indices and aliases were added in 7.7.0"

  - transform_and_set: { login_credentials: "#base64EncodeInput(get_alias_test_user:x-pack-test-password)" }

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      indices.create:
        index: test
        body:
          settings:
            number_of_shards: "1"
            number_of_replicas: "0"
            index:
              hidden: true
          aliases:
            test_alias:
              is_hidden: true

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases: {}

  - match:
      $body: |
        /^
            test_alias          \s+
            test                \s+
            -                   \s+
            -                   \s+
            -                   \s+
            -                   \s+
        $/

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases:
        name: test_alias

  - match:
      $body: |
        /^
            test_alias          \s+
            test                \s+
            -                   \s+
            -                   \s+
            -                   \s+
            -                   \s+
        $/


  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases:
        expand_wildcards: ["open","closed"]

  - match:
      $body: |
        /^
        $/
---
"Test cat aliases output with a hidden index with a visible alias":
  - requires:
      test_runner_features: headers
      cluster_features: ["gte_v7.7.0"]
      reason: "hidden indices and aliases were added in 7.7.0"

  - transform_and_set: { login_credentials: "#base64EncodeInput(get_alias_test_user:x-pack-test-password)" }

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      indices.create:
        index: test
        body:
          settings:
            number_of_shards: "1"
            number_of_replicas: "0"
            index:
              hidden: true
          aliases:
            test_alias: {}
  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases:
        name: test*

  - match:
      $body: |
        /^
            test_alias          \s+
            test                \s+
            -                   \s+
            -                   \s+
            -                   \s+
            -                   \s+
        $/

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases:
        name: test_alias

  - match:
      $body: |
        /^
            test_alias          \s+
            test                \s+
            -                   \s+
            -                   \s+
            -                   \s+
            -                   \s+
        $/

---
"Test cat aliases output with a visible index with a hidden alias":
  - requires:
      test_runner_features: headers
      cluster_features: ["gte_v7.7.0"]
      reason: "hidden indices and aliases were added in 7.7.0"

  - transform_and_set: { login_credentials: "#base64EncodeInput(get_alias_test_user:x-pack-test-password)" }

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      indices.create:
        index: test
        body:
          settings:
            number_of_shards: "1"
            number_of_replicas: "0"
          aliases:
            test_alias:
              is_hidden: true
  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases: {}

  - match:
      $body: |
        /^
            test_alias          \s+
            test                \s+
            -                   \s+
            -                   \s+
            -                   \s+
            -                   \s+
        $/

  - do:
      headers:
        Authorization: Basic ${login_credentials}
      cat.aliases:
        name: test_alias

  - match:
      $body: |
        /^
            test_alias          \s+
            test                \s+
            -                   \s+
            -                   \s+
            -                   \s+
            -                   \s+
        $/

###############################################
# Tests for ExtractSnippets function
#

extractSnippetsWithField
required_capability: extract_snippets_function

// tag::extract-snippets-with-field[]
FROM books
| WHERE MATCH(description, "hobbit")
| EVAL snippets = extract_snippets(description, "hobbit", 1, 25)
// end::extract-snippets-with-field[]
| KEEP book_no, author, title, snippets
| SORT book_no
| LIMIT 5
;

// tag::extract-snippets-with-field-result[]
book_no:keyword | author:text               | title:text                                                       | snippets:keyword
1463            | J. R. R. Tolkien          | Realms of Tolkien: Images of Middle-earth                        | appropriate passage from The Hobbit
2301            | John Ronald Reuel Tolkien | Smith of Wootton Major & Farmer Giles of Ham                     | beloved author of THE HOBBIT
2675            | J.R.R. Tolkien            | The Lord of the Rings - Boxed Set                                | Bilbo Baggins is a hobbit
2714            | J. R. R. Tolkien          | Return of the King Being the Third Part of The Lord of the Rings | the story begun in The Hobbit
2936            | John Ronald Reuel Tolkien | Fellowship of the Ring 2ND Edition                               | into the hands of the hobbit
// end::extract-snippets-with-field-result[]
;

extractMultipleSnippetsWithField
required_capability: extract_snippets_function

FROM books
| WHERE MATCH(description, "hobbit")
| EVAL snippets = extract_snippets(description, "hobbit", 3, 25)
| KEEP book_no, author, title, snippets
| SORT book_no
| LIMIT 5
;

book_no:keyword | author:text               | title:text                                                       | snippets:keyword
1463            | J. R. R. Tolkien          | Realms of Tolkien: Images of Middle-earth                        | appropriate passage from The Hobbit
2301            | John Ronald Reuel Tolkien | Smith of Wootton Major & Farmer Giles of Ham                     | beloved author of THE HOBBIT
2675            | J.R.R. Tolkien            | The Lord of the Rings - Boxed Set                                | [Bilbo Baggins is a hobbit, beautiful gift edition of The Hobbit, Tolkien's own children, The Hobbit]
2714            | J. R. R. Tolkien          | Return of the King Being the Third Part of The Lord of the Rings | [the story begun in The Hobbit, , THE HOBBIT: AN UNEXPECTED, film adaptation of The Hobbit]
2936            | John Ronald Reuel Tolkien | Fellowship of the Ring 2ND Edition                               | into the hands of the hobbit
;


extractMultipleSnippetsWithFieldMvExpand
required_capability: extract_snippets_function

FROM books
| WHERE MATCH(description, "hobbit")
| EVAL snippets = extract_snippets(description, "hobbit", 3, 25)
| MV_EXPAND snippets
| KEEP book_no, author, title, snippets
| SORT book_no
| LIMIT 5
;

book_no:keyword | author:text               | title:text                                   | snippets:keyword
1463            | J. R. R. Tolkien          | Realms of Tolkien: Images of Middle-earth    | appropriate passage from The Hobbit
2301            | John Ronald Reuel Tolkien | Smith of Wootton Major & Farmer Giles of Ham | beloved author of THE HOBBIT
2675            | J.R.R. Tolkien            | The Lord of the Rings - Boxed Set            | beautiful gift edition of The Hobbit
2675            | J.R.R. Tolkien            | The Lord of the Rings - Boxed Set            | Tolkien's own children, The Hobbit
2675            | J.R.R. Tolkien            | The Lord of the Rings - Boxed Set            | Bilbo Baggins is a hobbit
;

extractMultipleSnippetsWithSomeNoMatches
required_capability: extract_snippets_function

FROM books
| WHERE MATCH(author, "Faulkner")
| EVAL snippets = extract_snippets(description, "slavery", 1, 10)
| KEEP book_no, author, title, snippets
| SORT book_no
| LIMIT 5
;

book_no:keyword | author:text                                        | title:text                                                                                      | snippets:keyword
2378            | [Carol Faulkner, Holly Byers Ochoa, Lucretia Mott] | Selected Letters of Lucretia Coffin Mott (Women in American History)                            | abolition of slavery
2713            | William Faulkner                                   | Collected Stories of William Faulkner                                                           | null
2847            | Colleen Faulkner                                   | To Love A Dark Stranger (Lovegram Historical Romance)                                           | null
2883            | William Faulkner                                   | A Summer of Faulkner: As I Lay Dying/The Sound and the Fury/Light in August (Oprah's Book Club) | null
3293            | Danny Faulkner                                     | Universe by Design                                                                              | null
;


extractSnippetsWithDefaultNumSnippetsAndLength
required_capability: extract_snippets_function

extractSnippetsCalledMultipleTimes
required_capability: extract_snippets_function

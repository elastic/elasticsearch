empNo
required_capability: mv_sort

FROM employees
| STATS v = MV_SORT(VALUES(emp_no))
;

v:integer
[10001, 10002, 10003, 10004, 10005, 10006, 10007, 10008, 10009, 10010, 10011, 10012, 10013, 10014, 10015, 10016, 10017, 10018, 10019, 10020, 10021, 10022, 10023, 10024, 10025, 10026, 10027, 10028, 10029, 10030, 10031, 10032, 10033, 10034, 10035, 10036, 10037, 10038, 10039, 10040, 10041, 10042, 10043, 10044, 10045, 10046, 10047, 10048, 10049, 10050, 10051, 10052, 10053, 10054, 10055, 10056, 10057, 10058, 10059, 10060, 10061, 10062, 10063, 10064, 10065, 10066, 10067, 10068, 10069, 10070, 10071, 10072, 10073, 10074, 10075, 10076, 10077, 10078, 10079, 10080, 10081, 10082, 10083, 10084, 10085, 10086, 10087, 10088, 10089, 10090, 10091, 10092, 10093, 10094, 10095, 10096, 10097, 10098, 10099, 10100]
;

empNoByHireDate
required_capability: sparkline

FROM employees
| STATS v = SPARKLINE(emp_no, hire_date)
;

v:integer
[10009, 10048, 10098, 10076, 10061, 10070, 10013, 10080, 10029, 10064, 10002, 10053, 10066, 10090, 10079, 10001, 10095, 10089, 10003, 10087, 10081, 10004, 10067, 10014, 10033, 10075, 10083, 10018, 10058, 10094, 10078, 10015, 10068, 10025, 10100, 10071, 10060, 10039, 10021, 10065, 10052, 10072, 10088, 10035, 10034, 10099, 10007, 10047, 10063, 10006, 10027, 10010, 10045, 10005, 10038, 10092, 10069, 10041, 10023, 10082, 10096, 10011, 10056, 10086, 10077, 10032, 10074, 10097, 10043, 10037, 10050, 10020, 10059, 10062, 10031, 10028, 10073, 10036, 10057, 10055, 10049, 10046, 10051, 10091, 10012, 10040, 10042, 10017, 10030, 10085, 10044, 10008, 10016, 10054, 10026, 10022, 10084, 10093, 10024, 10019]
;

empNoByBirthYear
required_capability: mv_sort

FROM employees
| STATS v = MV_SORT(VALUES(emp_no)) BY birth_year = DATE_EXTRACT("year", BUCKET(birth_date, 1 year))
| SORT birth_year
| KEEP birth_year, v
;

birth_year:long | v:integer
1952            | [10009, 10020, 10022, 10063, 10066, 10072, 10076, 10097]
1953            | [10001, 10006, 10011, 10019, 10023, 10026, 10035, 10051, 10059, 10067, 10100]
1954            | [10004, 10018, 10053, 10057, 10058, 10073, 10088, 10096]
1955            | [10005, 10070, 10074, 10091]
1956            | [10014, 10029, 10033, 10055, 10099]
1957            | [10007, 10054, 10080, 10094]
1958            | [10008, 10017, 10024, 10025, 10030, 10050, 10071]
1959            | [10003, 10015, 10031, 10036, 10039, 10064, 10078, 10083, 10087]
1960            | [10012, 10021, 10032, 10038, 10069, 10075, 10081, 10084]
1961            | [10016, 10052, 10056, 10060, 10062, 10079, 10090, 10098]
1962            | [10027, 10034, 10061, 10068, 10085, 10086]
1963            | [10010, 10013, 10028, 10037, 10065, 10082, 10089]
1964            | [10002, 10077, 10092, 10093]
1965            | 10095
null            | [10040, 10041, 10042, 10043, 10044, 10045, 10046, 10047, 10048, 10049]
;

countByBirthYearByGender
required_capability: sparkline

FROM employees
| STATS count_per_year=COUNT(*) BY gender, @timestamp=BUCKET(birth_date, 1 year)
| STATS Count=SUM(count_per_year), Trend=SPARKLINE(count_per_year, @timestamp), Timestamps=MV_SORT(VALUES(@timestamp)) BY gender
| SORT gender
| KEEP gender, Count, Trend, Timestamps
;

# 57 vs 52 (M) and 33 vs 28 (F) because of birth_date being null
gender:keyword | Count:long | Trend:long                                 | Timestamps:datetime 
F              | 33         | [4, 4, 3, 1, 1, 2, 1, 2, 3, 3, 1, 1, 2]    | [1952-01-01T00:00:00.000Z, 1953-01-01T00:00:00.000Z, 1954-01-01T00:00:00.000Z, 1955-01-01T00:00:00.000Z, 1956-01-01T00:00:00.000Z, 1957-01-01T00:00:00.000Z, 1958-01-01T00:00:00.000Z, 1959-01-01T00:00:00.000Z, 1960-01-01T00:00:00.000Z, 1961-01-01T00:00:00.000Z, 1962-01-01T00:00:00.000Z, 1963-01-01T00:00:00.000Z, 1964-01-01T00:00:00.000Z]
M              | 57         | [4, 5, 4, 3, 3, 2, 5, 6, 4, 4, 5, 4, 2, 1] | [1952-01-01T00:00:00.000Z, 1953-01-01T00:00:00.000Z, 1954-01-01T00:00:00.000Z, 1955-01-01T00:00:00.000Z, 1956-01-01T00:00:00.000Z, 1957-01-01T00:00:00.000Z, 1958-01-01T00:00:00.000Z, 1959-01-01T00:00:00.000Z, 1960-01-01T00:00:00.000Z, 1961-01-01T00:00:00.000Z, 1962-01-01T00:00:00.000Z, 1963-01-01T00:00:00.000Z, 1964-01-01T00:00:00.000Z, 1965-01-01T00:00:00.000Z]
null           | 10         | [2, 1, 1, 1, 1, 1, 1, 2]                   | [1953-01-01T00:00:00.000Z, 1954-01-01T00:00:00.000Z, 1956-01-01T00:00:00.000Z, 1958-01-01T00:00:00.000Z, 1959-01-01T00:00:00.000Z, 1960-01-01T00:00:00.000Z, 1961-01-01T00:00:00.000Z, 1963-01-01T00:00:00.000Z]
;

empNoByHireDateByBirthYear
required_capability: sparkline

FROM employees
| STATS v = SPARKLINE(emp_no, hire_date) BY birth_year = DATE_EXTRACT("year", BUCKET(birth_date, 1 year))
| SORT birth_year
| KEEP birth_year, v
;

birth_year:long | v:integer
1952            | [10009, 10076, 10066, 10072, 10063, 10097, 10020, 10022]
1953            | [10001, 10067, 10100, 10035, 10006, 10023, 10011, 10059, 10051, 10026, 10019]
1954            | [10053, 10004, 10018, 10058, 10088, 10096, 10073, 10057]
1955            | [10070, 10005, 10074, 10091]
1956            | [10029, 10014, 10033, 10099, 10055]
1957            | [10080, 10094, 10007, 10054]
1958            | [10025, 10071, 10050, 10017, 10030, 10008, 10024]
1959            | [10064, 10003, 10087, 10083, 10078, 10015, 10039, 10031, 10036]
1960            | [10081, 10075, 10021, 10038, 10069, 10032, 10012, 10084]
1961            | [10098, 10090, 10079, 10060, 10052, 10056, 10062, 10016]
1962            | [10061, 10068, 10034, 10027, 10086, 10085]
1963            | [10013, 10089, 10065, 10010, 10082, 10037, 10028]
1964            | [10002, 10092, 10077, 10093]
1965            | 10095
null            | [10048, 10047, 10045, 10041, 10043, 10049, 10046, 10040, 10042, 10044]
;

empNoByHireDateByBirthYearWithConcatTrick
required_capability: mv_sort

FROM employees
| EVAL hire_date_and_emp_no=CONCAT(DATE_FORMAT("yyyy-MM-dd", hire_date), "/", TO_STRING(emp_no))
| STATS v = MV_SORT(VALUES(hire_date_and_emp_no)) BY birth_year = DATE_EXTRACT("year", BUCKET(birth_date, 1 year))
| SORT birth_year
| KEEP birth_year, v
;

birth_year:long | v:keyword
1952            | [1985-02-18/10009, 1985-07-09/10076, 1986-02-26/10066, 1988-07-21/10072, 1989-04-08/10063, 1990-09-15/10097, 1991-01-26/10020, 1995-08-22/10022]
1953            | [1986-06-26/10001, 1987-03-04/10067, 1987-09-21/10100, 1988-09-05/10035, 1989-06-02/10006, 1989-12-17/10023, 1990-01-22/10011, 1991-06-26/10059, 1992-10-15/10051, 1995-03-20/10026, 1999-04-30/10019]
1954            | [1986-02-04/10053, 1986-12-01/10004, 1987-04-03/10018, 1987-04-13/10058, 1988-09-02/10088, 1990-01-14/10096, 1991-12-01/10073, 1992-01-15/10057]
1955            | [1985-10-14/10070, 1989-09-12/10005, 1990-08-13/10074, 1992-11-18/10091]
1956            | [1985-11-20/10029, 1987-03-11/10014, 1987-03-18/10033, 1988-10-18/10099, 1992-04-27/10055]
1957            | [1985-11-19/10080, 1987-04-18/10094, 1989-02-10/10007, 1995-03-13/10054]
1958            | [1987-08-17/10025, 1987-10-01/10071, 1990-12-25/10050, 1993-08-03/10017, 1994-02-17/10030, 1994-09-15/10008, 1997-05-19/10024]
1959            | [1985-11-20/10064, 1986-08-28/10003, 1986-09-08/10087, 1987-03-31/10083, 1987-05-26/10078, 1987-07-02/10015, 1988-01-19/10039, 1991-09-01/10031, 1992-01-03/10036]
1960            | [1986-10-30/10081, 1987-03-19/10075, 1988-02-10/10021, 1989-09-20/10038, 1989-11-05/10069, 1990-06-20/10032, 1992-12-18/10012, 1995-12-15/10084]
1961            | [1985-05-13/10098, 1986-03-14/10090, 1986-03-27/10079, 1987-11-02/10060, 1988-05-21/10052, 1990-02-01/10056, 1991-08-30/10062, 1995-01-27/10016]
1962            | [1985-09-17/10061, 1987-08-07/10068, 1988-09-21/10034, 1989-07-07/10027, 1990-02-16/10086, 1994-04-09/10085]
1963            | [1985-10-20/10013, 1986-08-12/10089, 1988-05-18/10065, 1989-08-24/10010, 1990-01-03/10082, 1990-12-05/10037, 1991-10-22/10028]
1964            | [1985-11-21/10002, 1989-09-22/10092, 1990-03-02/10077, 1996-11-05/10093]
1965            | 1986-07-15/10095
null            | [1985-02-24/10048, 1989-03-31/10047, 1989-09-02/10045, 1989-11-12/10041, 1990-10-20/10043, 1992-05-04/10049, 1992-06-20/10046, 1993-02-14/10040, 1993-03-21/10042, 1994-05-21/10044]
;

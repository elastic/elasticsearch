singleIndexIp
FROM sample_data
| EVAL client_ip = TO_IP(client_ip)
| KEEP @timestamp, client_ip, event_duration, message
| SORT @timestamp DESC
;

@timestamp:date           |  client_ip:ip  |  event_duration:long  |  message:keyword
2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

singleIndexWhereIpLike
FROM sample_data
| WHERE TO_STRING(client_ip) LIKE "172.21.2.*"
| KEEP @timestamp, event_duration, message
| SORT @timestamp DESC
;

@timestamp:date           |  event_duration:long  |  message:keyword
2023-10-23T12:27:28.948Z  |  2764889              |  Connected to 10.1.0.2
2023-10-23T12:15:03.360Z  |  3450233              |  Connected to 10.1.0.3
;

singleIndexTsLong
FROM sample_data_ts_long
| EVAL @timestamp = TO_DATETIME(@timestamp)
| KEEP @timestamp, client_ip, event_duration, message
| SORT @timestamp DESC
;

@timestamp:date           |  client_ip:ip  |  event_duration:long  |  message:keyword
2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

singleIndexIpStats
required_capability: casting_operator

FROM sample_data
| EVAL client_ip = client_ip::ip
| STATS count=count(*) BY client_ip
| SORT count DESC, client_ip ASC
| KEEP count, client_ip
;

count:long  |  client_ip:ip  
4           |  172.21.3.15
1           |  172.21.0.5
1           |  172.21.2.113
1           |  172.21.2.162
;

singleIndexIpStringStats
required_capability: casting_operator

FROM sample_data_str
| EVAL client_ip = client_ip::ip
| STATS count=count(*) BY client_ip
| SORT count DESC, client_ip ASC
| KEEP count, client_ip
;

count:long  |  client_ip:ip
4           |  172.21.3.15
1           |  172.21.0.5
1           |  172.21.2.113
1           |  172.21.2.162
;

singleIndexIpStringStatsInline
required_capability: casting_operator

FROM sample_data_str
| STATS count=count(*) BY client_ip::ip
| STATS mc=count(count) BY count
| SORT mc DESC, count ASC
| KEEP mc, count
;

mc:l | count:l
3    | 1
1    | 4
;

multiIndexIpString
required_capability: union_types
required_capability: metadata_fields
required_capability: casting_operator
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str METADATA _index
| EVAL client_ip = client_ip::ip
| KEEP _index, @timestamp, client_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword  | @timestamp:date           |  client_ip:ip  |  event_duration:long  |  message:keyword
sample_data     | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data     | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data     | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data     | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data     | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data     | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data     | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_str | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_str | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_str | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_str | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_str | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_str | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_str | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexIpStringRename
required_capability: union_types
required_capability: metadata_fields
required_capability: casting_operator
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str METADATA _index
| EVAL host_ip = client_ip::ip
| KEEP _index, @timestamp, host_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword  | @timestamp:date           |  host_ip:ip    |  event_duration:long  |  message:keyword
sample_data     | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data     | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data     | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data     | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data     | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data     | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data     | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_str | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_str | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_str | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_str | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_str | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_str | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_str | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexIpStringRenameToString
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str METADATA _index
| EVAL host_ip = TO_STRING(TO_IP(client_ip))
| KEEP _index, @timestamp, host_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword  | @timestamp:date           |  host_ip:keyword  |  event_duration:long  |  message:keyword
sample_data     | 2023-10-23T13:55:01.543Z  |  172.21.3.15      |  1756467              |  Connected to 10.1.0.1
sample_data     | 2023-10-23T13:53:55.832Z  |  172.21.3.15      |  5033755              |  Connection error
sample_data     | 2023-10-23T13:52:55.015Z  |  172.21.3.15      |  8268153              |  Connection error
sample_data     | 2023-10-23T13:51:54.732Z  |  172.21.3.15      |  725448               |  Connection error
sample_data     | 2023-10-23T13:33:34.937Z  |  172.21.0.5       |  1232382              |  Disconnected
sample_data     | 2023-10-23T12:27:28.948Z  |  172.21.2.113     |  2764889              |  Connected to 10.1.0.2
sample_data     | 2023-10-23T12:15:03.360Z  |  172.21.2.162     |  3450233              |  Connected to 10.1.0.3
sample_data_str | 2023-10-23T13:55:01.543Z  |  172.21.3.15      |  1756467              |  Connected to 10.1.0.1
sample_data_str | 2023-10-23T13:53:55.832Z  |  172.21.3.15      |  5033755              |  Connection error
sample_data_str | 2023-10-23T13:52:55.015Z  |  172.21.3.15      |  8268153              |  Connection error
sample_data_str | 2023-10-23T13:51:54.732Z  |  172.21.3.15      |  725448               |  Connection error
sample_data_str | 2023-10-23T13:33:34.937Z  |  172.21.0.5       |  1232382              |  Disconnected
sample_data_str | 2023-10-23T12:27:28.948Z  |  172.21.2.113     |  2764889              |  Connected to 10.1.0.2
sample_data_str | 2023-10-23T12:15:03.360Z  |  172.21.2.162     |  3450233              |  Connected to 10.1.0.3
;

multiIndexWhereIpString
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str METADATA _index
| WHERE STARTS_WITH(TO_STRING(client_ip), "172.21.2")
| KEEP _index, @timestamp, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword  | @timestamp:date           |  event_duration:long  |  message:keyword
sample_data     | 2023-10-23T12:27:28.948Z  |  2764889              |  Connected to 10.1.0.2
sample_data     | 2023-10-23T12:15:03.360Z  |  3450233              |  Connected to 10.1.0.3
sample_data_str | 2023-10-23T12:27:28.948Z  |  2764889              |  Connected to 10.1.0.2
sample_data_str | 2023-10-23T12:15:03.360Z  |  3450233              |  Connected to 10.1.0.3
;

multiIndexWhereIpStringLike
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str METADATA _index
| WHERE TO_STRING(client_ip) LIKE "172.21.2.*"
| KEEP _index, @timestamp, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword  | @timestamp:date           |  event_duration:long  |  message:keyword
sample_data     | 2023-10-23T12:27:28.948Z  |  2764889              |  Connected to 10.1.0.2
sample_data     | 2023-10-23T12:15:03.360Z  |  3450233              |  Connected to 10.1.0.3
sample_data_str | 2023-10-23T12:27:28.948Z  |  2764889              |  Connected to 10.1.0.2
sample_data_str | 2023-10-23T12:15:03.360Z  |  3450233              |  Connected to 10.1.0.3
;

multiIndexSortIpString
required_capability: union_types
required_capability: casting_operator
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str
| SORT client_ip::ip
| LIMIT 1
;

@timestamp:date           |  client_ip:null  |  event_duration:long  |  message:keyword
2023-10-23T13:33:34.937Z  |  null            |  1232382              |  Disconnected
;

multiIndexSortIpStringEval
required_capability: union_types
required_capability: casting_operator
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str
| SORT client_ip::ip, @timestamp ASC
| EVAL client_ip_as_ip = client_ip::ip
| LIMIT 1
;

@timestamp:date           |  client_ip:null  |  event_duration:long  |  message:keyword | client_ip_as_ip:ip
2023-10-23T13:33:34.937Z  |  null            |  1232382              |  Disconnected    | 172.21.0.5
;

multiIndexIpStringStats
required_capability: union_types
required_capability: casting_operator
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str
| EVAL client_ip = client_ip::ip
| STATS count=count(*) BY client_ip
| SORT count DESC, client_ip ASC
| KEEP count, client_ip
;

count:long  |  client_ip:ip
8           |  172.21.3.15
2           |  172.21.0.5
2           |  172.21.2.113
2           |  172.21.2.162
;

multiIndexIpStringRenameStats
required_capability: union_types
required_capability: casting_operator
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str
| EVAL host_ip = client_ip::ip
| STATS count=count(*) BY host_ip
| SORT count DESC, host_ip ASC
| KEEP count, host_ip
;

count:long  |  host_ip:ip
8           |  172.21.3.15
2           |  172.21.0.5
2           |  172.21.2.113
2           |  172.21.2.162
;

multiIndexIpStringRenameToStringStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str
| EVAL host_ip = TO_STRING(TO_IP(client_ip))
| STATS count=count(*) BY host_ip
| SORT count DESC, host_ip ASC
| KEEP count, host_ip
;

count:long  |  host_ip:keyword
8           |  172.21.3.15
2           |  172.21.0.5
2           |  172.21.2.113
2           |  172.21.2.162
;

multiIndexIpStringStatsDrop
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: casting_operator

FROM sample_data, sample_data_str
| STATS count=count(*) BY client_ip::ip
| KEEP count
| SORT count DESC
;

count:long
8
2
2
2
;

multiIndexIpStringStatsInline
required_capability: union_types
required_capability: union_types_inline_fix

FROM sample_data, sample_data_str
| STATS count=count(*) BY client_ip = TO_IP(client_ip)
| SORT count DESC, client_ip ASC
| KEEP count, client_ip
;

count:long  |  client_ip:ip
8           |  172.21.3.15
2           |  172.21.0.5
2           |  172.21.2.113
2           |  172.21.2.162
;

statsUnionAggInline
required_capability: union_types
required_capability: inlinestats

FROM sample_data, sample_data_str
| STATS
    count = COUNT(CIDR_MATCH(TO_IP(client_ip), "172.21.0.0/24") OR NULL)
  BY
    @timestamp = DATE_TRUNC(10 minutes, @timestamp)
| SORT count DESC, @timestamp ASC
| LIMIT 4
;

count:long | @timestamp:date
         2 | 2023-10-23T13:30:00.000Z
         0 | 2023-10-23T12:10:00.000Z
         0 | 2023-10-23T12:20:00.000Z
         0 | 2023-10-23T13:50:00.000Z
;


multiIndexIpStringStatsInline2
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: casting_operator

FROM sample_data, sample_data_str
| STATS count=count(*) BY client_ip::ip
| SORT count DESC, `client_ip::ip` ASC
;

count:long  |  client_ip::ip:ip
8           |  172.21.3.15
2           |  172.21.0.5
2           |  172.21.2.113
2           |  172.21.2.162
;

multiIndexIpStringStatsInline3
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: casting_operator

FROM sample_data, sample_data_str
| STATS count=count(*) BY client_ip::ip
| STATS mc=count(count) BY count
| SORT mc DESC, count ASC
;

mc:l | count:l
3    | 2
1    | 8
;

multiIndexWhereIpStringStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_str
| WHERE STARTS_WITH(TO_STRING(client_ip), "172.21.2")
| STATS count=count(*) BY message
| SORT count DESC, message ASC
| KEEP count, message
;

count:long  |  message:keyword
2           |  Connected to 10.1.0.2
2           |  Connected to 10.1.0.3
;

multiIndexMissingIpToString
required_capability: union_types
required_capability: union_types_missing_field

FROM sample_data, sample_data_str, missing_ip_sample_data METADATA _index
| EVAL client_ip = TO_STRING(client_ip)
| KEEP _index, @timestamp, client_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword         | @timestamp:date           |  client_ip:keyword  |  event_duration:long  |  message:keyword
missing_ip_sample_data | 2023-10-23T13:55:01.543Z  |  null               |  1756467              |  Connected to 10.1.0.1
missing_ip_sample_data | 2023-10-23T13:53:55.832Z  |  null               |  5033755              |  Connection error
missing_ip_sample_data | 2023-10-23T13:52:55.015Z  |  null               |  8268153              |  Connection error
missing_ip_sample_data | 2023-10-23T13:51:54.732Z  |  null               |  725448               |  Connection error
missing_ip_sample_data | 2023-10-23T13:33:34.937Z  |  null               |  1232382              |  Disconnected
missing_ip_sample_data | 2023-10-23T12:27:28.948Z  |  null               |  2764889              |  Connected to 10.1.0.2
missing_ip_sample_data | 2023-10-23T12:15:03.360Z  |  null               |  3450233              |  Connected to 10.1.0.3
sample_data            | 2023-10-23T13:55:01.543Z  |  172.21.3.15        |  1756467              |  Connected to 10.1.0.1
sample_data            | 2023-10-23T13:53:55.832Z  |  172.21.3.15        |  5033755              |  Connection error
sample_data            | 2023-10-23T13:52:55.015Z  |  172.21.3.15        |  8268153              |  Connection error
sample_data            | 2023-10-23T13:51:54.732Z  |  172.21.3.15        |  725448               |  Connection error
sample_data            | 2023-10-23T13:33:34.937Z  |  172.21.0.5         |  1232382              |  Disconnected
sample_data            | 2023-10-23T12:27:28.948Z  |  172.21.2.113       |  2764889              |  Connected to 10.1.0.2
sample_data            | 2023-10-23T12:15:03.360Z  |  172.21.2.162       |  3450233              |  Connected to 10.1.0.3
sample_data_str        | 2023-10-23T13:55:01.543Z  |  172.21.3.15        |  1756467              |  Connected to 10.1.0.1
sample_data_str        | 2023-10-23T13:53:55.832Z  |  172.21.3.15        |  5033755              |  Connection error
sample_data_str        | 2023-10-23T13:52:55.015Z  |  172.21.3.15        |  8268153              |  Connection error
sample_data_str        | 2023-10-23T13:51:54.732Z  |  172.21.3.15        |  725448               |  Connection error
sample_data_str        | 2023-10-23T13:33:34.937Z  |  172.21.0.5         |  1232382              |  Disconnected
sample_data_str        | 2023-10-23T12:27:28.948Z  |  172.21.2.113       |  2764889              |  Connected to 10.1.0.2
sample_data_str        | 2023-10-23T12:15:03.360Z  |  172.21.2.162       |  3450233              |  Connected to 10.1.0.3
;

multiIndexMissingIpToIp
required_capability: union_types
required_capability: union_types_missing_field

FROM sample_data, sample_data_str, missing_ip_sample_data METADATA _index
| EVAL client_ip = TO_IP(client_ip)
| KEEP _index, @timestamp, client_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword         | @timestamp:date           |  client_ip:ip  |  event_duration:long  |  message:keyword
missing_ip_sample_data | 2023-10-23T13:55:01.543Z  |  null          |  1756467              |  Connected to 10.1.0.1
missing_ip_sample_data | 2023-10-23T13:53:55.832Z  |  null          |  5033755              |  Connection error
missing_ip_sample_data | 2023-10-23T13:52:55.015Z  |  null          |  8268153              |  Connection error
missing_ip_sample_data | 2023-10-23T13:51:54.732Z  |  null          |  725448               |  Connection error
missing_ip_sample_data | 2023-10-23T13:33:34.937Z  |  null          |  1232382              |  Disconnected
missing_ip_sample_data | 2023-10-23T12:27:28.948Z  |  null          |  2764889              |  Connected to 10.1.0.2
missing_ip_sample_data | 2023-10-23T12:15:03.360Z  |  null          |  3450233              |  Connected to 10.1.0.3
sample_data            | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data            | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data            | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data            | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data            | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data            | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data            | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_str        | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_str        | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_str        | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_str        | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_str        | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_str        | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_str        | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexTsLong
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long METADATA _index
| EVAL @timestamp = TO_DATETIME(@timestamp)
| KEEP _index, @timestamp, client_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword      | @timestamp:date           |  client_ip:ip  |  event_duration:long  |  message:keyword
sample_data         | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data         | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data         | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data         | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data         | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data         | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data         | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_ts_long | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_ts_long | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_ts_long | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_ts_long | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexTsLongRename
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long METADATA _index
| EVAL ts = TO_DATETIME(@timestamp)
| KEEP _index, ts, client_ip, event_duration, message
| SORT _index ASC, ts DESC
;

_index:keyword      | ts:date                   |  client_ip:ip  |  event_duration:long  |  message:keyword
sample_data         | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data         | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data         | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data         | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data         | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data         | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data         | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_ts_long | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_ts_long | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_ts_long | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_ts_long | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexTsLongRenameToString
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long METADATA _index
| EVAL ts = TO_STRING(TO_DATETIME(@timestamp))
| KEEP _index, ts, client_ip, event_duration, message
| SORT _index ASC, ts DESC
;

_index:keyword      | ts:keyword                |  client_ip:ip  |  event_duration:long  |  message:keyword
sample_data         | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data         | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data         | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data         | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data         | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data         | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data         | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_ts_long | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_ts_long | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_ts_long | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_ts_long | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexWhereTsLong
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long METADATA _index
| WHERE TO_LONG(@timestamp) < 1698068014937
| KEEP _index, client_ip, event_duration, message
| SORT _index ASC, client_ip ASC
;

_index:keyword       | client_ip:ip  |  event_duration:long  |  message:keyword
sample_data          | 172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data          | 172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long  | 172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long  | 172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexTsLongStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| EVAL @timestamp = DATE_TRUNC(1 hour, TO_DATETIME(@timestamp))
| STATS count=count(*) BY @timestamp
| SORT count DESC, @timestamp ASC
| KEEP count, @timestamp
;

count:long  |  @timestamp:date
10          |  2023-10-23T13:00:00.000Z
4           |  2023-10-23T12:00:00.000Z
;

multiIndexTsLongStatsDrop
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: casting_operator

FROM sample_data, sample_data_ts_long
| STATS count=count(*) BY @timestamp::datetime
| KEEP count
;

count:long
2
2
2
2
2
2
2
;

multiIndexTsLongStatsInline2
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: casting_operator

FROM sample_data, sample_data_ts_long
| STATS count=count(*) BY @timestamp::datetime
| SORT count DESC, `@timestamp::datetime` DESC
;

count:long  |  @timestamp::datetime:datetime
2           |  2023-10-23T13:55:01.543Z
2           |  2023-10-23T13:53:55.832Z
2           |  2023-10-23T13:52:55.015Z
2           |  2023-10-23T13:51:54.732Z
2           |  2023-10-23T13:33:34.937Z
2           |  2023-10-23T12:27:28.948Z
2           |  2023-10-23T12:15:03.360Z
;

multiIndexTsLongStatsInline3
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: casting_operator

FROM sample_data, sample_data_ts_long
| STATS count=count(*) BY @timestamp::datetime
| STATS mc=count(count) BY count
| SORT mc DESC, count ASC
;

mc:l | count:l
7    | 2
;

multiIndexTsLongStatsStats
required_capability: union_types
required_capability: union_types_agg_cast
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| EVAL ts = TO_STRING(@timestamp)
| STATS count = COUNT(*) BY ts
| STATS mc = COUNT(count) BY count
| SORT mc DESC, count ASC
;

mc:l | count:l
14   | 1
;

multiIndexTsLongRenameStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| EVAL hour = DATE_TRUNC(1 hour, TO_DATETIME(@timestamp))
| STATS count=count(*) BY hour
| SORT count DESC, hour ASC
| KEEP count, hour
;

count:long  |  hour:date
10          |  2023-10-23T13:00:00.000Z
4           |  2023-10-23T12:00:00.000Z
;

multiIndexTsLongRenameToDatetimeToStringStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| EVAL hour = LEFT(TO_STRING(TO_DATETIME(@timestamp)), 13)
| STATS count=count(*) BY hour
| SORT count DESC, hour ASC
| KEEP count, hour
;

count:long  |  hour:keyword
10          |  2023-10-23T13
4           |  2023-10-23T12
;

multiIndexTsLongRenameToStringStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| EVAL mess = LEFT(TO_STRING(@timestamp), 7)
| STATS count=count(*) BY mess
| SORT count DESC, mess DESC
| KEEP count, mess
;

count:long  |  mess:keyword
7           |  2023-10
4           |  1698069
1           |  1698068
1           |  1698064
1           |  1698063
;

multiIndexTsLongStatsInline
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| STATS count=COUNT(*), max=MAX(TO_DATETIME(@timestamp))
| KEEP count, max
;

count:long  |  max:date
14          |  2023-10-23T13:55:01.543Z
;

multiIndexTsLongStatsInlineDropped
required_capability: union_types

FROM sample_data, sample_data_ts_long
| STATS count=COUNT(*), max=MAX(TO_DATETIME(@timestamp))
| KEEP count
;

count:long
14
;

multiIndexWhereTsLongStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data, sample_data_ts_long
| WHERE TO_LONG(@timestamp) < 1698068014937
| STATS count=count(*) BY message
| SORT count DESC, message ASC
| KEEP count, message
;

count:long  |  message:keyword
2           |  Connected to 10.1.0.2
2           |  Connected to 10.1.0.3
;

multiIndexIpStringTsLong
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| EVAL @timestamp = TO_DATETIME(@timestamp), client_ip = TO_IP(client_ip)
| KEEP _index, @timestamp, client_ip, event_duration, message
| SORT _index ASC, @timestamp DESC
;

_index:keyword      | @timestamp:date           |  client_ip:ip  |  event_duration:long  |  message:keyword
sample_data         | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data         | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data         | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data         | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data         | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data         | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data         | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_str     | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_str     | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_str     | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_str     | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_str     | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_str     | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_str     | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_ts_long | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_ts_long | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_ts_long | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_ts_long | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexIpStringTsLongDropped
required_capability: union_types
required_capability: metadata_fields

FROM sample_data* METADATA _index
| EVAL @timestamp = TO_DATETIME(@timestamp), client_ip = TO_IP(client_ip)
| KEEP _index, event_duration, message
| SORT _index ASC, event_duration ASC
;

_index:keyword      |  event_duration:long  |  message:keyword
sample_data         |  725448               |  Connection error
sample_data         |  1232382              |  Disconnected
sample_data         |  1756467              |  Connected to 10.1.0.1
sample_data         |  2764889              |  Connected to 10.1.0.2
sample_data         |  3450233              |  Connected to 10.1.0.3
sample_data         |  5033755              |  Connection error
sample_data         |  8268153              |  Connection error
sample_data_str     |  725448               |  Connection error
sample_data_str     |  1232382              |  Disconnected
sample_data_str     |  1756467              |  Connected to 10.1.0.1
sample_data_str     |  2764889              |  Connected to 10.1.0.2
sample_data_str     |  3450233              |  Connected to 10.1.0.3
sample_data_str     |  5033755              |  Connection error
sample_data_str     |  8268153              |  Connection error
sample_data_ts_long |  725448               |  Connection error
sample_data_ts_long |  1232382              |  Disconnected
sample_data_ts_long |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long |  5033755              |  Connection error
sample_data_ts_long |  8268153              |  Connection error
;

multiIndexIpStringTsLongRename
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| EVAL ts = TO_DATETIME(@timestamp), host_ip = TO_IP(client_ip)
| KEEP _index, ts, host_ip, event_duration, message
| SORT _index ASC, ts DESC
;

_index:keyword      | ts:date                   |  host_ip:ip    |  event_duration:long  |  message:keyword
sample_data         | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data         | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data         | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data         | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data         | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data         | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data         | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_str     | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_str     | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_str     | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_str     | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_str     | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_str     | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_str     | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long | 2023-10-23T13:55:01.543Z  |  172.21.3.15   |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long | 2023-10-23T13:53:55.832Z  |  172.21.3.15   |  5033755              |  Connection error
sample_data_ts_long | 2023-10-23T13:52:55.015Z  |  172.21.3.15   |  8268153              |  Connection error
sample_data_ts_long | 2023-10-23T13:51:54.732Z  |  172.21.3.15   |  725448               |  Connection error
sample_data_ts_long | 2023-10-23T13:33:34.937Z  |  172.21.0.5    |  1232382              |  Disconnected
sample_data_ts_long | 2023-10-23T12:27:28.948Z  |  172.21.2.113  |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long | 2023-10-23T12:15:03.360Z  |  172.21.2.162  |  3450233              |  Connected to 10.1.0.3
;

multiIndexIpStringTsLongRenameDropped
required_capability: union_types
required_capability: metadata_fields

FROM sample_data* METADATA _index
| EVAL ts = TO_DATETIME(@timestamp), host_ip = TO_IP(client_ip)
| KEEP _index, event_duration, message
| SORT _index ASC, event_duration ASC
;

_index:keyword      |  event_duration:long  |  message:keyword
sample_data         |  725448               |  Connection error
sample_data         |  1232382              |  Disconnected
sample_data         |  1756467              |  Connected to 10.1.0.1
sample_data         |  2764889              |  Connected to 10.1.0.2
sample_data         |  3450233              |  Connected to 10.1.0.3
sample_data         |  5033755              |  Connection error
sample_data         |  8268153              |  Connection error
sample_data_str     |  725448               |  Connection error
sample_data_str     |  1232382              |  Disconnected
sample_data_str     |  1756467              |  Connected to 10.1.0.1
sample_data_str     |  2764889              |  Connected to 10.1.0.2
sample_data_str     |  3450233              |  Connected to 10.1.0.3
sample_data_str     |  5033755              |  Connection error
sample_data_str     |  8268153              |  Connection error
sample_data_ts_long |  725448               |  Connection error
sample_data_ts_long |  1232382              |  Disconnected
sample_data_ts_long |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long |  5033755              |  Connection error
sample_data_ts_long |  8268153              |  Connection error
;

multiIndexIpStringTsLongRenameToString
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| EVAL ts = TO_STRING(TO_DATETIME(@timestamp)), host_ip = TO_STRING(TO_IP(client_ip))
| KEEP _index, ts, host_ip, event_duration, message
| SORT _index ASC, ts DESC
;

_index:keyword      | ts:keyword                |  host_ip:keyword  |  event_duration:long  |  message:keyword
sample_data         | 2023-10-23T13:55:01.543Z  |  172.21.3.15      |  1756467              |  Connected to 10.1.0.1
sample_data         | 2023-10-23T13:53:55.832Z  |  172.21.3.15      |  5033755              |  Connection error
sample_data         | 2023-10-23T13:52:55.015Z  |  172.21.3.15      |  8268153              |  Connection error
sample_data         | 2023-10-23T13:51:54.732Z  |  172.21.3.15      |  725448               |  Connection error
sample_data         | 2023-10-23T13:33:34.937Z  |  172.21.0.5       |  1232382              |  Disconnected
sample_data         | 2023-10-23T12:27:28.948Z  |  172.21.2.113     |  2764889              |  Connected to 10.1.0.2
sample_data         | 2023-10-23T12:15:03.360Z  |  172.21.2.162     |  3450233              |  Connected to 10.1.0.3
sample_data_str     | 2023-10-23T13:55:01.543Z  |  172.21.3.15      |  1756467              |  Connected to 10.1.0.1
sample_data_str     | 2023-10-23T13:53:55.832Z  |  172.21.3.15      |  5033755              |  Connection error
sample_data_str     | 2023-10-23T13:52:55.015Z  |  172.21.3.15      |  8268153              |  Connection error
sample_data_str     | 2023-10-23T13:51:54.732Z  |  172.21.3.15      |  725448               |  Connection error
sample_data_str     | 2023-10-23T13:33:34.937Z  |  172.21.0.5       |  1232382              |  Disconnected
sample_data_str     | 2023-10-23T12:27:28.948Z  |  172.21.2.113     |  2764889              |  Connected to 10.1.0.2
sample_data_str     | 2023-10-23T12:15:03.360Z  |  172.21.2.162     |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long | 2023-10-23T13:55:01.543Z  |  172.21.3.15      |  1756467              |  Connected to 10.1.0.1
sample_data_ts_long | 2023-10-23T13:53:55.832Z  |  172.21.3.15      |  5033755              |  Connection error
sample_data_ts_long | 2023-10-23T13:52:55.015Z  |  172.21.3.15      |  8268153              |  Connection error
sample_data_ts_long | 2023-10-23T13:51:54.732Z  |  172.21.3.15      |  725448               |  Connection error
sample_data_ts_long | 2023-10-23T13:33:34.937Z  |  172.21.0.5       |  1232382              |  Disconnected
sample_data_ts_long | 2023-10-23T12:27:28.948Z  |  172.21.2.113     |  2764889              |  Connected to 10.1.0.2
sample_data_ts_long | 2023-10-23T12:15:03.360Z  |  172.21.2.162     |  3450233              |  Connected to 10.1.0.3
;

multiIndexWhereIpStringTsLong
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| WHERE TO_LONG(@timestamp) < 1698068014937 AND TO_STRING(client_ip) == "172.21.2.162"
| KEEP _index, event_duration, message
| SORT _index ASC, message ASC
;

_index:keyword       |  event_duration:long  |  message:keyword
sample_data          |  3450233              |  Connected to 10.1.0.3
sample_data_str      |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long  |  3450233              |  Connected to 10.1.0.3
;

multiIndexWhereIpStringTsLongStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data*
| WHERE TO_LONG(@timestamp) < 1698068014937 AND TO_STRING(client_ip) == "172.21.2.162"
| STATS count=count(*) BY message
| SORT count DESC, message ASC
| KEEP count, message
;

count:long  |  message:keyword
3           |  Connected to 10.1.0.3
;

multiIndexWhereIpStringLikeTsLong
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| WHERE TO_LONG(@timestamp) < 1698068014937 AND TO_STRING(client_ip) LIKE "172.21.2.16?"
| KEEP _index, event_duration, message
| SORT _index ASC, message ASC
;

_index:keyword       |  event_duration:long  |  message:keyword
sample_data          |  3450233              |  Connected to 10.1.0.3
sample_data_str      |  3450233              |  Connected to 10.1.0.3
sample_data_ts_long  |  3450233              |  Connected to 10.1.0.3
;

multiIndexWhereIpStringLikeTsLongStats
required_capability: union_types
required_capability: union_types_remove_fields

FROM sample_data*
| WHERE TO_LONG(@timestamp) < 1698068014937 AND TO_STRING(client_ip) LIKE "172.21.2.16?"
| STATS count=count(*) BY message
| SORT count DESC, message ASC
| KEEP count, message
;

count:long  |  message:keyword
3           |  Connected to 10.1.0.3
;

multiIndexMultiColumnTypesRename
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| WHERE event_duration > 8000000
| EVAL ts = TO_DATETIME(@timestamp), ts_str = TO_STRING(@timestamp), ts_l = TO_LONG(@timestamp), ip = TO_IP(client_ip), ip_str = TO_STRING(client_ip) 
| SORT _index ASC, ts DESC
;

@timestamp:null | client_ip:null | event_duration:long | message:keyword  | _index:keyword      | ts:date                   | ts_str:keyword            | ts_l:long      |  ip:ip         |  ip_str:k
null            | null           |  8268153            | Connection error | sample_data         | 2023-10-23T13:52:55.015Z  | 2023-10-23T13:52:55.015Z  | 1698069175015  |  172.21.3.15   |  172.21.3.15
null            | null           |  8268153            | Connection error | sample_data_str     | 2023-10-23T13:52:55.015Z  | 2023-10-23T13:52:55.015Z  | 1698069175015  |  172.21.3.15   |  172.21.3.15
null            | null           |  8268153            | Connection error | sample_data_ts_long | 2023-10-23T13:52:55.015Z  | 1698069175015             | 1698069175015  |  172.21.3.15   |  172.21.3.15
;

multiIndexMultiColumnTypesRenameAndKeep
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| WHERE event_duration > 8000000
| EVAL ts = TO_DATETIME(@timestamp), ts_str = TO_STRING(@timestamp), ts_l = TO_LONG(@timestamp), ip = TO_IP(client_ip), ip_str = TO_STRING(client_ip) 
| KEEP _index, ts, ts_str, ts_l, ip, ip_str, event_duration
| SORT _index ASC, ts DESC
;

_index:keyword      | ts:date                   | ts_str:keyword            | ts_l:long      |  ip:ip         |  ip_str:k      |  event_duration:long
sample_data         | 2023-10-23T13:52:55.015Z  | 2023-10-23T13:52:55.015Z  | 1698069175015  |  172.21.3.15   |  172.21.3.15   |  8268153
sample_data_str     | 2023-10-23T13:52:55.015Z  | 2023-10-23T13:52:55.015Z  | 1698069175015  |  172.21.3.15   |  172.21.3.15   |  8268153
sample_data_ts_long | 2023-10-23T13:52:55.015Z  | 1698069175015             | 1698069175015  |  172.21.3.15   |  172.21.3.15   |  8268153
;

multiIndexMultiColumnTypesRenameAndDrop
required_capability: union_types
required_capability: metadata_fields
required_capability: union_types_remove_fields

FROM sample_data* METADATA _index
| WHERE event_duration > 8000000
| EVAL ts = TO_DATETIME(@timestamp), ts_str = TO_STRING(@timestamp), ts_l = TO_LONG(@timestamp), ip = TO_IP(client_ip), ip_str = TO_STRING(client_ip) 
| DROP @timestamp, client_ip, message
| SORT _index ASC, ts DESC
;

event_duration:long | _index:keyword      | ts:date                   | ts_str:keyword            | ts_l:long      |  ip:ip         |  ip_str:k  
8268153             | sample_data         | 2023-10-23T13:52:55.015Z  | 2023-10-23T13:52:55.015Z  | 1698069175015  |  172.21.3.15   |  172.21.3.15
8268153             | sample_data_str     | 2023-10-23T13:52:55.015Z  | 2023-10-23T13:52:55.015Z  | 1698069175015  |  172.21.3.15   |  172.21.3.15
8268153             | sample_data_ts_long | 2023-10-23T13:52:55.015Z  | 1698069175015             | 1698069175015  |  172.21.3.15   |  172.21.3.15
;


inlineStatsUnionGroup-Ignore
required_capability: union_types
required_capability: inlinestats

FROM sample_data, sample_data_ts_long
| INLINESTATS count = COUNT(*)
           BY @timestamp = SUBSTRING(TO_STRING(@timestamp), 0, 7)
| SORT client_ip ASC, @timestamp ASC
| LIMIT 4
;

client_ip:ip | event_duration:long |    message:keyword    | @timestamp:keyword | count:long
  172.21.0.5 |             1232382 | Disconnected          |            1698068 | 1
  172.21.0.5 |             1232382 | Disconnected          |            2023-10 | 7
172.21.2.113 |             2764889 | Connected to 10.1.0.2 |            1698064 | 1
172.21.2.113 |             2764889 | Connected to 10.1.0.2 |            2023-10 | 7
;

inlineStatsUnionGroupWithEval-Ignore
required_capability: union_types
required_capability: inlinestats

FROM sample_data, sample_data_ts_long
| EVAL @timestamp = SUBSTRING(TO_STRING(@timestamp), 0, 7)
| INLINESTATS count = COUNT(*) BY @timestamp
| SORT client_ip ASC, @timestamp ASC
| LIMIT 4
;

client_ip:ip | event_duration:long |    message:keyword    | @timestamp:keyword | count:long
  172.21.0.5 |             1232382 | Disconnected          |            1698068 | 1
  172.21.0.5 |             1232382 | Disconnected          |            2023-10 | 7
172.21.2.113 |             2764889 | Connected to 10.1.0.2 |            1698064 | 1
172.21.2.113 |             2764889 | Connected to 10.1.0.2 |            2023-10 | 7
;

inlineStatsUnionGroupTogether-Ignore
required_capability: union_types
required_capability: inlinestats

FROM sample_data, sample_data_ts_long
| INLINESTATS count = COUNT(*)
           BY @timestamp = TO_STRING(TO_DATETIME(@timestamp))
| SORT client_ip ASC, @timestamp ASC
| LIMIT 4
;

client_ip:ip | event_duration:long |    message:keyword    |    @timestamp:keyword    | count:long
  172.21.0.5 |             1232382 | Disconnected          | 2023-10-23T13:33:34.937Z | 2
  172.21.0.5 |             1232382 | Disconnected          | 2023-10-23T13:33:34.937Z | 2
172.21.2.113 |             2764889 | Connected to 10.1.0.2 | 2023-10-23T12:27:28.948Z | 2
172.21.2.113 |             2764889 | Connected to 10.1.0.2 | 2023-10-23T12:27:28.948Z | 2
;

# Once INLINESTATS supports expressions in agg functions and groups, convert the group in the inlinestats

multiIndexIndirectUseOfUnionTypesInSort
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword
           null | 172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInEval
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| EVAL foo = event_duration > 1232381
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword | foo:boolean
           null | 172.21.0.5   |             1232382 | Disconnected    | true
;

multiIndexIndirectUseOfUnionTypesInRename
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: union_types_fix_rename_resolution
FROM sample_data, sample_data_ts_long
| RENAME message AS event_message
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | event_message:keyword
           null | 172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInKeep
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| KEEP client_ip, event_duration, message
| SORT client_ip ASC
| LIMIT 1
;

client_ip:ip | event_duration:long | message:keyword
172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInWildcardKeep
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: union_types_fix_rename_resolution
FROM sample_data, sample_data_ts_long
| KEEP *
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword
           null | 172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInWildcardKeep2
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: union_types_fix_rename_resolution
FROM sample_data, sample_data_ts_long
| KEEP *e*
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword
           null | 172.21.0.5   |             1232382 | Disconnected
;


multiIndexUseOfUnionTypesInKeep
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: union_types_fix_rename_resolution
FROM sample_data, sample_data_ts_long
| KEEP @timestamp
| LIMIT 1
;

@timestamp:null
null
;

multiIndexUseOfUnionTypesInDrop
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: union_types_fix_rename_resolution
FROM sample_data, sample_data_ts_long
| DROP @timestamp
| SORT client_ip ASC
| LIMIT 1
;

client_ip:ip | event_duration:long | message:keyword
172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInWildcardDrop
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: union_types_fix_rename_resolution
FROM sample_data, sample_data_ts_long
| DROP *time*
| SORT client_ip ASC
| LIMIT 1
;

client_ip:ip | event_duration:long | message:keyword
172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInWhere
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| WHERE message == "Disconnected"
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword
           null | 172.21.0.5   |             1232382 | Disconnected
           null | 172.21.0.5   |             1232382 | Disconnected
;

multiIndexIndirectUseOfUnionTypesInDissect
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| DISSECT message "%{foo}"
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword | foo:keyword
           null | 172.21.0.5   |             1232382 | Disconnected    | Disconnected
;

multiIndexIndirectUseOfUnionTypesInGrok
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| GROK message "%{WORD:foo}"
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword | foo:keyword
           null | 172.21.0.5   |             1232382 | Disconnected    | Disconnected
;

multiIndexIndirectUseOfUnionTypesInEnrich
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: enrich_load
FROM sample_data, sample_data_ts_long
| EVAL client_ip = client_ip::keyword
| ENRICH clientip_policy ON client_ip WITH env
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | event_duration:long | message:keyword | client_ip:keyword | env:keyword
           null |             1232382 | Disconnected    | 172.21.0.5        | Development
;

multiIndexIndirectUseOfUnionTypesInStats
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| STATS foo = max(event_duration) BY client_ip
| SORT client_ip ASC
;

foo:long | client_ip:ip
 1232382 | 172.21.0.5
 2764889 | 172.21.2.113
 3450233 | 172.21.2.162
 8268153 | 172.21.3.15
;

multiIndexIndirectUseOfUnionTypesInInlineStats
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: inlinestats
FROM sample_data, sample_data_ts_long
| INLINESTATS foo = max(event_duration)
| SORT client_ip ASC
| LIMIT 1
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword | foo:long
           null | 172.21.0.5   |             1232382 | Disconnected    |  8268153
;

multiIndexIndirectUseOfUnionTypesInLookup
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
required_capability: lookup_v4
FROM sample_data, sample_data_ts_long
| SORT client_ip ASC
| LIMIT 1
| EVAL int = (event_duration - 1232380)::integer
| LOOKUP int_number_names ON int
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword | int:integer | name:keyword
           null | 172.21.0.5   |             1232382 | Disconnected    |           2 | two
;

multiIndexIndirectUseOfUnionTypesInMvExpand
// TODO: `union_types` is required only because this makes the test skip in the csv tests; better solution:
// make the csv tests work with multiple indices.
required_capability: union_types
FROM sample_data, sample_data_ts_long
| EVAL foo = MV_APPEND(message, message)
| SORT client_ip ASC
| LIMIT 1
| MV_EXPAND foo
;

@timestamp:null | client_ip:ip | event_duration:long | message:keyword | foo:keyword
           null | 172.21.0.5   |             1232382 | Disconnected    | Disconnected
           null | 172.21.0.5   |             1232382 | Disconnected    | Disconnected
;

shortIntegerWidening
required_capability: union_types
required_capability: metadata_fields
required_capability: casting_operator
required_capability: union_types_numeric_widening

FROM apps, apps_short METADATA _index
| EVAL id = id::integer
| KEEP _index, id, version, name
| WHERE name == "aaaaa" OR name == "hhhhh"
| SORT _index ASC, id ASC
;

_index:keyword | id:integer  | version:version  | name:keyword
apps           | 1           | 1                | aaaaa
apps           | 8           | 1.2.3.4          | hhhhh
apps           | 12          | 1.2.3.4          | aaaaa
apps_short     | 1           | 1                | aaaaa
apps_short     | 8           | 1.2.3.4          | hhhhh
apps_short     | 12          | 1.2.3.4          | aaaaa
;

shortIntegerWideningStats
required_capability: union_types
required_capability: casting_operator
required_capability: union_types_numeric_widening

FROM apps, apps_short
| EVAL id = id::integer
| STATS count=count() BY name, id
| KEEP id, name, count
| SORT id ASC, name ASC
;

id:integer | name:keyword | count:long
1          | aaaaa        | 2
2          | bbbbb        | 2
3          | ccccc        | 2
4          | ddddd        | 2
5          | eeeee        | 2
6          | fffff        | 2
7          | ggggg        | 2
8          | hhhhh        | 2
9          | iiiii        | 2
10         | jjjjj        | 2
11         | kkkkk        | 2
12         | aaaaa        | 2
13         | lllll        | 2
14         | mmmmm        | 2
;
